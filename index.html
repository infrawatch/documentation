<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="generator" content="Asciidoctor 2.0.12"/>
<meta name="author" content="OpenStack Documentation Team"/>
<title>Service Telemetry Framework 1.2</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"/>
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Service Telemetry Framework 1.2</h1>
<div class="details">
<span id="author" class="author">OpenStack Documentation Team</span><br/>
<span id="email" class="email"><a href="mailto:rhos-docs@redhat.com">rhos-docs@redhat.com</a></span><br/>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction-to-stf_assembly">Introduction to Service&#160;Telemetry&#160;Framework 1.2</a>
<ul class="sectlevel2">
<li><a href="#architecture_introduction-to-stf">Service&#160;Telemetry&#160;Framework architecture</a></li>
<li><a href="#installation-size_introduction-to-stf">Installation size</a></li>
</ul>
</li>
<li><a href="#installing-the-core-components-of-stf_introduction-to-stf">Installing the core components of Service&#160;Telemetry&#160;Framework</a>
<ul class="sectlevel2">
<li><a href="#installing-the-core-components-of-stf_installing-the-core-components-of-stf">The core components of STF</a></li>
<li><a href="#preparing-your-openshift-environment-for-stf_installing-the-core-components-of-stf">Preparing your OKD environment for STF</a></li>
<li><a href="#deploying-stf-to-the-openshift-environment_installing-the-core-components-of-stf">Deploying STF to the OKD environment</a></li>
<li><a href="#removing-stf-from-the-openshift-environment_installing-the-core-components-of-stf">Removing STF from the OKD environment</a></li>
</ul>
</li>
<li><a href="#completing-the-stf-configuration_installing-the-core-components-of-stf">Completing the Service&#160;Telemetry&#160;Framework configuration</a>
<ul class="sectlevel2">
<li><a href="#connecting-openstack_completing-the-stf-configuration">Connecting OpenStack to Service&#160;Telemetry&#160;Framework</a></li>
<li><a href="#deploying-to-non-standard-network-topologies_completing-the-stf-configuration">Deploying to non-standard network topologies</a></li>
<li><a href="#configuring-red-hat-openstack-platform-overcloud-for-stf_completing-the-stf-configuration">Configuring OpenStack overcloud for Service&#160;Telemetry&#160;Framework</a></li>
</ul>
</li>
<li><a href="#advanced-features_completing-the-stf-configuration">Advanced features</a>
<ul class="sectlevel2">
<li><a href="#manifest-overrides_advanced-features">Customizing the deployment</a></li>
<li><a href="#alerts_advanced-features">Alerts</a></li>
<li><a href="#configuring-snmp-traps_advanced-features">Configuring SNMP Traps</a></li>
<li><a href="#high-availability_advanced-features">High availability</a></li>
<li><a href="#dashboards_advanced-features">Dashboards</a></li>
<li><a href="#configuring-multiple-clouds_advanced-features">Multiple cloud configuration</a></li>
<li><a href="#ephemeral-storage_advanced-features">Ephemeral storage</a></li>
<li><a href="#monitoring-resource-usage-of-openstack-services_advanced-features">Monitoring the resource usage of OpenStack services</a></li>
<li><a href="#exposing-routes_advanced-features">Creating a route in OpenShift</a></li>
</ul>
</li>
<li><a href="#appe-stf-collectd-plugins">Appendix A: collectd plug-ins</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="introduction-to-stf_assembly">Introduction to Service&#160;Telemetry&#160;Framework 1.2</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Service&#160;Telemetry&#160;Framework (STF) receives monitoring data from OpenStack or third-party nodes for storage, dashboarding, and alerting. The monitoring data can be either of two types:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Metric</dt>
<dd>
<p>a numeric measurement of an application or system</p>
</dd>
<dt class="hdlist1">Event</dt>
<dd>
<p>irregular and discrete occurrences that happen in a system</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The collection components that are required on the clients are lightweight. The multicast message bus that is shared by all clients and the deployment provides fast and reliable data transport. Other modular components for receiving and storing data are deployed in containers on OKD.</p>
</div>
<div class="paragraph">
<p>STF provides access to monitoring functions such as alert generation, visualization through dashboards, and single source of truth telemetry analysis to support orchestration.</p>
</div>
<div class="sect2">
<h3 id="architecture_introduction-to-stf">Service&#160;Telemetry&#160;Framework architecture</h3>
<div class="paragraph">
<p>Service&#160;Telemetry&#160;Framework (STF) uses the components described in <a href="#table-stf-components">STF components</a>:</p>
</div>
<table id="table-stf-components" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. STF components</caption>
<colgroup>
<col style="width: 15%;"/>
<col style="width: 70%;"/>
<col style="width: 15%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Client</th>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Server (OKD)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An AMQP 1.x compatible messaging bus to shuttle the metrics to STF for storage in Prometheus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart Gateway to pick metrics and events from the AMQP 1.x bus and to deliver events to ElasticSearch or to provide metrics to Prometheus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prometheus as time-series data storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ElasticSearch as events data storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">collectd to collect infrastructure metrics and events</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ceilometer to collect OpenStack metrics and events</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
</tbody>
</table>
<div id="osp-stf-overview" class="imageblock">
<div class="content">
<img src="images/OpenStack_STF_Overview_37_1019_arch.png" alt="Service Telemetry Framework architecture overview"/>
</div>
<div class="title">Figure 1. Service Telemetry Framework architecture overview</div>
</div>
<div class="paragraph">
<p>For metrics, on the client side, collectd provides infrastructure metrics (without project data), and Ceilometer provides OpenStack platform data based on projects or user workload. Both Ceilometer and collectd deliver data to Prometheus by using the Apache&#160;Qpid&#160;Dispatch&#160;Router transport, delivering the data through the message bus. On the server side, a Golang application called the Smart Gateway takes the data stream from the bus and exposes it as a local scrape endpoint for Prometheus.</p>
</div>
<div class="paragraph">
<p>If you plan to collect and store events, collectd or Ceilometer delivers event data to the server side by using the Apache&#160;Qpid&#160;Dispatch&#160;Router transport, delivering the data through the message bus. Another Smart Gateway writes the data to the ElasticSearch datastore.</p>
</div>
<div class="paragraph">
<p>Server-side STF monitoring infrastructure consists of the following layers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Service&#160;Telemetry&#160;Framework 1.2 (STF)</p>
</li>
<li>
<p>OpenShift 4.5 (OKD)</p>
</li>
<li>
<p>Infrastructure platform</p>
</li>
</ul>
</div>
<div id="osp-stf-server-side-monitoring" class="imageblock">
<div class="content">
<img src="images/STF_Overview_37_0819_deployment_prereq.png" alt="Server-side STF monitoring infrastructure"/>
</div>
<div class="title">Figure 2. Server-side STF monitoring infrastructure</div>
</div>
<div class="paragraph">
<p>For more information about how to deploy OpenShift, see the  <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.5/">OKD product documentation</a>. You can install OKD on cloud platforms or on bare metal.
For more information about STF performance and scaling, see <a href="https://access.redhat.com/articles/4907241" class="bare">https://access.redhat.com/articles/4907241</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Do not install OKD on the same infrastructure that you want to monitor.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="installation-size_introduction-to-stf">Installation size</h3>
<div class="paragraph">
<p>The size of your OpenShift installation depends on the following factors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The number of nodes you want to monitor.</p>
</li>
<li>
<p>The number of metrics you want to collect.</p>
</li>
<li>
<p>The resolution of metrics.</p>
</li>
<li>
<p>The length of time that you want to store the data.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Installation of Service&#160;Telemetry&#160;Framework (STF) depends on the existing OpenShift environment. Ensure that you install monitoring for OpenStack on a platform separate from your OpenStack environment. You can install OpenShift (OKD) on baremetal or other supported cloud platforms. For more information about installing OKD, see <a href="https://docs.openshift.com/container-platform/4.5/welcome/index.html#cluster-installer-activities">OpenShift Container Platform 4.5 Documentation</a>.</p>
</div>
<div class="paragraph">
<p>The size of your OKD environment depends on the infrastructure you select. For more information about minimum resources requirements when installing OKD on baremetal, see <a href="https://docs.openshift.com/container-platform/4.5/installing/installing_bare_metal/installing-bare-metal.html#minimum-resource-requirements_installing-bare-metal">Minimum resource requirements</a> in the <em>Installing a cluster on bare metal</em> guide. For installation requirements of the various public and private cloud platforms which you can install, see the corresponding installation documentation for your cloud platform of choice.</p>
</div>
<div class="sect3">
<h4 id="development-environment-resource-requirement_introduction-to-stf">Development environment resource requirements</h4>
<div class="paragraph">
<p>You can create an all-in-one development environment for STF locally by using <a href="https://code-ready.github.io/crc/">CodeReady Containers</a>. The installation process of CodeReady Containers (CRC) is available at <a href="https://code-ready.github.io/crc/#installation_gsg" class="bare">https://code-ready.github.io/crc/#installation_gsg</a>.</p>
</div>
<div class="paragraph">
<p>The <a href="https://code-ready.github.io/crc/#minimum-system-requirements-hardware_gsg">minimum resource requirements</a> for CRC is not enough by default to run STF. Ensure that your host system has the following resources available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>4 physical cores (8 hyperthreaded cores)</p>
</li>
<li>
<p>64 GB of memory</p>
</li>
<li>
<p>80 GB of storage space</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After you complete the installation of CRC, use the <code>crc start</code> command to start your environment. The recommended minimum system resources for running STF in CodeReady Containers is 48 GB of memory and 8 virtual CPU cores:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">crc start --memory=49152 --cpus=8</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have an existing environment, delete it, and recreate it to ensure that the resource requests have an effect.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enter the <code>crc delete</code> command.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">crc delete</code></pre>
</div>
</div>
</li>
<li>
<p>Run the <code>crc start</code> command to create your environment:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">crc start --memory=49152 --cpus=8</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installing-the-core-components-of-stf_introduction-to-stf">Installing the core components of Service&#160;Telemetry&#160;Framework</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before you install Service&#160;Telemetry&#160;Framework (STF), ensure that OpenShift (OKD) version 4.5 is running and that you understand the core components of the framework. As part of the OKD installation planning process, ensure that the administrator provides persistent storage and enough resources to run the STF components on top of the OKD environment.</p>
</div>
<div class="sect2">
<h3 id="installing-the-core-components-of-stf_installing-the-core-components-of-stf">The core components of STF</h3>
<div class="paragraph">
<p>The following STF core components are managed by Operators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Prometheus and AlertManager</p>
</li>
<li>
<p>ElasticSearch</p>
</li>
<li>
<p>Smart Gateway</p>
</li>
<li>
<p>Apache&#160;Qpid&#160;Dispatch&#160;Router</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each component has a corresponding Operator that you can use to load the various application components and objects.</p>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>For more information about Operators, see the <a href="https://docs.openshift.com/container-platform/4.5/operators/olm-what-operators-are.html">Understanding Operators</a> guide.</p>
</div>
</div>
<div class="sect2">
<h3 id="preparing-your-openshift-environment-for-stf_installing-the-core-components-of-stf">Preparing your OKD environment for STF</h3>
<div class="paragraph">
<p>As you prepare your OKD environment for STF, you must plan for persistent storage, adequate resources, and event storage:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure that persistent storage is available in your OpenShift cluster to permit a production grade deployment. For more information, see <a href="#persistent-volumes">Persistent volumes</a>.</p>
</li>
<li>
<p>Ensure that enough resources are available to run the Operators and the application containers. For more information, see <a href="#resource-allocation">Resource allocation</a>.</p>
</li>
<li>
<p>To install ElasticSearch, you must use a community catalog source. If you do not want to use a community catalog or if you do not want to store events, see <a href="#deploying-stf-to-the-openshift-environment_installing-the-core-components-of-stf">Deploying STF to the OKD environment</a>.</p>
</li>
<li>
<p>STF uses ElasticSearch to store events, which requires a larger than normal <code>vm.max_map_count</code>. The <code>vm.max_map_count</code> value is set by default in OpenShift. For more information about how to edit the value of <code>vm.max_map_count</code>, see <a href="#node-tuning-operator">Node tuning operator</a>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="persistent-volumes">Persistent volumes</h4>
<div class="paragraph">
<p>STF uses persistent storage in OKD to instantiate the volumes dynamically so that Prometheus and ElasticSearch can store metrics and events. When persistent storage is enabled through the Service Telemetry Operator, the Persistent Volume Claims requested in an STF deployment results in an access mode of RWO (ReadWriteOnce). If your environment contains pre-provisioned persistent volumes, ensure that volumes of RWO are available in the OKD default configured <code>storageClass</code>. For more information about recommended configurable storage technology in OpenShift, see <a href="https://docs.openshift.com/container-platform/4.5/scalability_and_performance/optimizing-storage.html#recommended-configurable-storage-technology_persistent-storage">Recommended configurable storage technology</a>.</p>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>For more information about configuring persistent storage for OKD, see <a href="https://docs.openshift.com/container-platform/4.5/storage/understanding-persistent-storage.html">Understanding persistent storage.</a></p>
</div>
<div class="sect4">
<h5 id="ephemeral-storage">Using ephemeral storage</h5>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
You can use ephemeral storage with STF. However, if you use ephemeral storage, you might experience data loss if a pod is restarted, updated, or rescheduled onto another node. Use ephemeral storage only for development or testing, and not production environments.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>For more information about enabling ephemeral storage for STF, see <a href="#configuring-ephemeral-storage_advanced-features">Configuring ephemeral storage</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="resource-allocation">Resource allocation</h4>
<div class="paragraph">
<p>To enable the scheduling of pods within the OKD infrastructure, you need resources for the components that are running. If you do not allocate enough resources, pods remain in a <code>Pending</code> state because they cannot be scheduled.</p>
</div>
<div class="paragraph">
<p>The amount of resources that you require to run STF depends on your environment and the number of nodes and clouds that you want to monitor.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For recommendations about sizing for metrics collection, see <a href="https://access.redhat.com/articles/4907241" class="bare">https://access.redhat.com/articles/4907241</a>.</p>
</li>
<li>
<p>For information about sizing requirements for ElasticSearch, see <a href="https://www.elastic.co/guide/en/cloud-on-k8s/current/k8s-managing-compute-resources.html" class="bare">https://www.elastic.co/guide/en/cloud-on-k8s/current/k8s-managing-compute-resources.html</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="metrics-retention-time-period">Metrics retention time period</h4>
<div class="paragraph">
<p>The default retention time for metrics stored in STF is 24 hours, which provides enough data to allow for trends to develop for the purposes of alerting. To adjust STF for additional metrics retention time, set a new value in <code>backends.metrics.prometheus.storage.retention</code>, for example, <code>7d</code> for seven days. If you use long retention periods, returning data from heavily populated Prometheus systems can result in queries returning slowly.</p>
</div>
<div class="paragraph">
<p>For long-term storage, use systems designed for long-term data retention, for example, <a href="https://thanos.io/">Thanos</a>.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For recommendations about Prometheus data storage and estimating storage space, see <a href="https://prometheus.io/docs/prometheus/latest/storage/#operational-aspects" class="bare">https://prometheus.io/docs/prometheus/latest/storage/#operational-aspects</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="node-tuning-operator">Node tuning operator</h4>
<div class="paragraph">
<p>STF uses ElasticSearch to store events, which requires a larger than normal <code>vm.max_map_count</code>. The <code>vm.max_map_count</code> value is set by default in OpenShift.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If your host platform is a typical OpenShift 4 environment, do not make any adjustments. The default node tuning operator is configured to account for ElasticSearch workloads.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to edit the value of <code>vm.max_map_count</code>, you cannot apply node tuning manually using the <code>sysctl</code> command because OpenShift manages nodes directly. To configure values and apply them to the infrastructure, you must use the node tuning operator. For more information, see <a href="https://docs.openshift.com/container-platform/4.5/scalability_and_performance/using-node-tuning-operator.html">Using the Node Tuning Operator</a>.</p>
</div>
<div class="paragraph">
<p>In an OKD deployment, the default node tuning operator specification provides the required profiles for ElasticSearch workloads or pods scheduled on nodes. To view the default cluster node tuning specification, run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc get Tuned/default -o yaml -n openshift-cluster-node-tuning-operator</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of the default specification is documented at <a href="https://docs.openshift.com/container-platform/4.5/scalability_and_performance/using-node-tuning-operator.html#custom-tuning-default-profiles-set_node-tuning-operator">Default profiles set on a cluster</a>. You can manage the assignment of profiles in the <code>recommend</code> section where profiles are applied to a node when certain conditions are met. When scheduling ElasticSearch to a node in STF, one of the following profiles is applied:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>openshift-control-plane-es</code></p>
</li>
<li>
<p><code>openshift-node-es</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When scheduling an ElasticSearch pod, there must be a label present that matches <code>tuned.openshift.io/elasticsearch</code>. If the label is present, one of the two profiles is assigned to the pod. No action is required by the administrator if you use the recommended Operator for ElasticSearch. If you use a custom-deployed ElasticSearch with STF, ensure that you add the <code>tuned.openshift.io/elasticsearch</code> label to all scheduled pods.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about virtual memory usage by ElasticSearch, see <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/vm-max-map-count.html" class="bare">https://www.elastic.co/guide/en/elasticsearch/reference/current/vm-max-map-count.html</a></p>
</li>
<li>
<p>For more information about how the profiles are applied to nodes, see <a href="https://docs.openshift.com/container-platform/4.5/scalability_and_performance/using-node-tuning-operator.html#custom-tuning-specification_node-tuning-operator">Custom tuning specification</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deploying-stf-to-the-openshift-environment_installing-the-core-components-of-stf">Deploying STF to the OKD environment</h3>
<div class="paragraph">
<p>You can deploy STF to the OKD environment in one of two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deploy STF and store events with ElasticSearch. For more information, see <a href="#deploying-stf-to-the-openshift-environment-with-elasticsearch">Deploying STF to the OKD environment with ElasticSearch</a>.</p>
</li>
<li>
<p>Deploy STF without ElasticSearch and disable events support. For more information, see <a href="#deploying-stf-to-the-openshift-environment-without-elasticsearch">Deploying STF to the OKD environment without ElasticSearch</a>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="deploying-stf-to-the-openshift-environment-with-elasticsearch">Deploying STF to the OKD environment with ElasticSearch</h4>
<div class="paragraph">
<p>Complete the following tasks:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#creating-a-namespace">Creating a namespace</a>.</p>
</li>
<li>
<p><a href="#creating-an-operatorgroup">Creating an OperatorGroup</a>.</p>
</li>
<li>
<p><a href="#enabling-the-operatorhubio-community-catalog-source">Enabling the OperatorHub.io Community Catalog Source</a>.</p>
</li>
<li>
<p><a href="#enabling-the-infrawatch-catalog-source">Enabling InfraWatch Catalog Source</a>.</p>
</li>
<li>
<p><a href="#subscribing-to-the-amq-certificate-manager-operator">Subscribing to the AMQ Certificate Manager Operator</a>.</p>
</li>
<li>
<p><a href="#subscribing-to-elastic-cloud-on-kubernetes-operator">Subscribing to the Elastic Cloud on Kubernetes Operator</a>.</p>
</li>
<li>
<p><a href="#subscribing-to-the-service-telemetry-operator">Subscribing to the Service Telemetry Operator</a>.</p>
</li>
<li>
<p><a href="#creating-a-servicetelemetry-object-in-openshift">Creating a ServiceTelemetry object in OKD</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="deploying-stf-to-the-openshift-environment-without-elasticsearch">Deploying STF to the OKD environment without ElasticSearch</h4>
<div class="paragraph">
<p>Complete the following tasks:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#creating-a-namespace">Creating a namespace</a>.</p>
</li>
<li>
<p><a href="#creating-an-operatorgroup">Creating an OperatorGroup</a>.</p>
</li>
<li>
<p><a href="#enabling-the-infrawatch-catalog-source">Enabling InfraWatch Catalog Source</a>.</p>
</li>
<li>
<p><a href="#subscribing-to-the-amq-certificate-manager-operator">Subscribing to the AMQ Certificate Manager Operator</a>.</p>
</li>
<li>
<p><a href="#subscribing-to-the-service-telemetry-operator">Subscribing to the Service Telemetry Operator</a>.</p>
</li>
<li>
<p><a href="#creating-a-servicetelemetry-object-in-openshift">Creating a ServiceTelemetry object in OKD</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="creating-a-namespace">Creating a namespace</h4>
<div class="paragraph">
<p>Create a namespace to hold the STF components. The <code>service-telemetry</code> namespace is used throughout the documentation:</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc new-project service-telemetry</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="creating-an-operatorgroup">Creating an OperatorGroup</h4>
<div class="paragraph">
<p>Create an OperatorGroup in the namespace so that you can schedule the Operator pods.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc apply -f - &lt;&lt;EOF
apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: service-telemetry-operator-group
  namespace: service-telemetry
spec:
  targetNamespaces:
  - service-telemetry
EOF</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>For more information, see <a href="https://docs.openshift.com/container-platform/4.5/operators/understanding_olm/olm-understanding-operatorgroups.html">OperatorGroups</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="enabling-the-operatorhubio-community-catalog-source">Enabling the OperatorHub.io Community Catalog Source</h4>
<div class="paragraph">
<p>Before you install ElasticSearch, you must have access to the resources on the OperatorHub.io Community Catalog Source:</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc apply -f - &lt;&lt;EOF
apiVersion: operators.coreos.com/v1alpha1
kind: CatalogSource
metadata:
  name: operatorhubio-operators
  namespace: openshift-marketplace
spec:
  sourceType: grpc
  image: quay.io/operator-framework/upstream-community-operators:latest
  displayName: OperatorHub.io Operators
  publisher: OperatorHub.io
EOF</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="enabling-the-infrawatch-catalog-source">Enabling InfraWatch Catalog Source</h4>
<div class="paragraph">
<p>Before you deploy STF on OpenShift, you must enable the catalog source.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install a CatalogSource that contains the Service Telemetry Operator and the Smart Gateway Operator:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc apply -f - &lt;&lt;EOF
apiVersion: operators.coreos.com/v1alpha1
kind: CatalogSource
metadata:
  name: infrawatch-operators
  namespace: openshift-marketplace
spec:
  displayName: InfraWatch Operators
  image: quay.io/infrawatch-operators/infrawatch-catalog:latest
  publisher: InfraWatch
  sourceType: grpc
  updateStrategy:
    registryPoll:
      interval: 30m
EOF</code></pre>
</div>
</div>
</li>
<li>
<p>To validate the creation of your CatalogSource, use the <code>oc get catalogsources</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">$ oc get -nopenshift-marketplace catalogsource infrawatch-operators

NAME                   DISPLAY                TYPE   PUBLISHER    AGE
infrawatch-operators   InfraWatch Operators   grpc   InfraWatch   2m16s</code></pre>
</div>
</div>
</li>
<li>
<p>To validate that the Operators are available from the catalog, use the <code>oc get packagemanifest</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">$ oc get packagemanifests | grep InfraWatch

service-telemetry-operator                    InfraWatch Operators       7m20s
smart-gateway-operator                        InfraWatch Operators       7m20s</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="subscribing-to-the-amq-certificate-manager-operator">Subscribing to the AMQ Certificate Manager Operator</h4>
<div class="paragraph">
<p>You must subscribe to the AMQ Certificate Manager Operator before you deploy the other STF components because the AMQ Certificate Manager Operator runs globally-scoped. The AMQ Certificate Manager Operator is not compatible with the dependency management of Operator Lifecycle Manager when you use it with other namespace-scoped operators.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Subscribe to the AMQ Certificate Manager Operator, create the subscription, and validate the AMQ7 Certificate Manager:</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The AMQ Certificate Manager is installed globally for all namespaces, so the <code>namespace</code> value provided is <code>openshift-operators</code>. You might not see your <code>amq7-cert-manager.v1.0.0</code> ClusterServiceVersion in the <code>service-telemetry</code> namespace for a few minutes until the processing executes against the namespace.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc apply -f - &lt;&lt;EOF
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: amq7-cert-manager
  namespace: openshift-operators
spec:
  channel: alpha
  installPlanApproval: Automatic
  name: amq7-cert-manager
  source: redhat-operators
  sourceNamespace: openshift-marketplace
EOF</code></pre>
</div>
</div>
</li>
<li>
<p>To validate your <code>ClusterServiceVersion</code>, use the <code>oc get csv</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">$ oc get --namespace openshift-operators csv

NAME                       DISPLAY                                         VERSION   REPLACES   PHASE
amq7-cert-manager.v1.0.0   Red Hat Integration - AMQ Certificate Manager   1.0.0                Succeeded</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ensure that amq7-cert-manager.v1.0.0 has a phase <code>Succeeded</code>.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="subscribing-to-elastic-cloud-on-kubernetes-operator">Subscribing to the Elastic Cloud on Kubernetes Operator</h4>
<div class="paragraph">
<p>Before you install the Service Telemetry Operator and if you plan to store events in ElasticSearch, you must enable the Elastic Cloud Kubernetes Operator.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Apply the following manifest to your OKD environment to enable the Elastic Cloud on Kubernetes Operator:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc apply -f - &lt;&lt;EOF
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: elastic-cloud-eck
  namespace: service-telemetry
spec:
  channel: stable
  installPlanApproval: Automatic
  name: elastic-cloud-eck
  source: operatorhubio-operators
  sourceNamespace: openshift-marketplace
EOF</code></pre>
</div>
</div>
</li>
<li>
<p>To verify that the <code>ClusterServiceVersion</code> for ElasticSearch Cloud on Kubernetes <code>succeeded</code>, enter the <code>oc get csv</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">$ oc get csv

NAME                       DISPLAY                                         VERSION   REPLACES   PHASE
elastic-cloud-eck.v1.2.1   Elastic Cloud on Kubernetes                     1.2.1                Succeeded</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="subscribing-to-the-service-telemetry-operator">Subscribing to the Service Telemetry Operator</h4>
<div class="paragraph">
<p>You must subscribe to the Service Telemetry Operator, which manages the STF instances.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To create the Service Telemetry Operator subscription, enter the <code>oc apply -f</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc apply -f - &lt;&lt;EOF
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: service-telemetry-operator
  namespace: service-telemetry
spec:
  channel: stable
  installPlanApproval: Automatic
  name: service-telemetry-operator
  source: infrawatch-operators
  sourceNamespace: openshift-marketplace
EOF</code></pre>
</div>
</div>
</li>
<li>
<p>To validate the Service Telemetry Operator and the dependent operators, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">$ oc get csv --namespace service-telemetry
NAME                                DISPLAY                                         VERSION   REPLACES   PHASE
amq7-cert-manager.v1.0.0            Red Hat Integration - AMQ Certificate Manager   1.0.0                Succeeded
amq7-interconnect-operator.v1.2.1   Red Hat Integration - AMQ Interconnect          1.2.1                Succeeded
elastic-cloud-eck.v1.2.1            Elastic Cloud on Kubernetes                     1.2.1                Succeeded
prometheusoperator.0.37.0           Prometheus Operator                             0.37.0               Succeeded
service-telemetry-operator.v1.1.0   Service Telemetry Operator                      1.1.0                Succeeded
smart-gateway-operator.v2.1.0       Smart Gateway Operator                          2.1.0                Succeeded</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="overview-of-the-servicetelemetry-object">Overview of the ServiceTelemetry object</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Versions of Service Telemetry Operator prior to v1.1.0 used a flat API (<code>servicetelemetry.infra.watch/v1alpha1</code>) interface for creating the <code>ServiceTelemetry</code> object.
In Service Telemetry Operator v1.1.0, there is a dictionary-based API interface (<code>servicetelemetry.infra.watch/v1beta1</code>) to allow for better control of STF deployments, including managing multi-cluster deployments natively, and allowing the management of additional storage backends in the future. Ensure that any previously created <code>ServiceTelemetry</code> objects are updated to the new interface.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To deploy the Service&#160;Telemetry&#160;Framework, you must create an instance of <code>ServiceTelemetry</code> in OKD. The <code>ServiceTelemetry</code> object is made up of the following major configuration parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>alerting</code></p>
</li>
<li>
<p><code>backends</code></p>
</li>
<li>
<p><code>clouds</code></p>
</li>
<li>
<p><code>graphing</code></p>
</li>
<li>
<p><code>highAvailability</code></p>
</li>
<li>
<p><code>transports</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each of these top-level configuration parameters provides various controls for a Service&#160;Telemetry&#160;Framework deployment.</p>
</div>
<div class="sect4">
<h5 id="_backends">backends</h5>
<div class="paragraph">
<p>Use the <code>backends</code> parameter to control which storage backends are available for storage of metrics and events, and to control the enablement of Smart Gateways, as defined by the <code>clouds</code> parameter. For more information, see <a href="#clouds_installing-the-core-components-of-stf">clouds</a>.</p>
</div>
<div class="paragraph">
<p>Currently, you can use Prometheus as the metrics backend, and ElasticSearch as the events backend.</p>
</div>
<div class="sect5">
<h6 id="_enabling_prometheus_as_a_storage_backend_for_metrics">Enabling Prometheus as a storage backend for metrics</h6>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To enable Prometheus as a storage backend for metrics, configure the <code>ServiceTelemetry</code> object:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: infra.watch/v1beta1
kind: ServiceTelemetry
metadata:
  name: default
  namespace: service-telemetry
spec:
  backends:
    metrics:
      prometheus:
        enabled: true</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_enabling_elasticsearch_as_a_storage_backend_for_events">Enabling ElasticSearch as a storage backend for events</h6>
<div class="paragraph">
<p>To enable events support in STF, you must enable the Elastic Cloud for Kubernetes Operator. For more information, see <a href="#subscribing-to-elastic-cloud-on-kubernetes-operator">Subscribing to the Elastic Cloud on Kubernetes Operator</a>. By default, ElasticSearch storage of events is disabled. For more information, see <a href="#deploying-stf-to-the-openshift-environment-without-elasticsearch">Deploying STF to the OKD environment without ElasticSearch</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="clouds_installing-the-core-components-of-stf">clouds</h5>
<div class="paragraph">
<p>Use the <code>clouds</code> parameter to control which Smart Gateway objects are deployed, thereby providing the interface for multiple monitored cloud environments to connect to an instance of STF. If a supporting backend is available, then metrics and events Smart Gateways for the default cloud configuration are created. By default, the Service Telemetry Operator creates Smart Gateways for <code>cloud1</code>.</p>
</div>
<div class="paragraph">
<p>You can create a list of cloud objects to control which Smart Gateways are created for each cloud defined. Each cloud is made up of data types and collectors. Data types are <code>metrics</code> or <code>events</code>. Each data type is made up of a list of collectors and the message bus subscription address. Available collectors are <code>collectd</code> and <code>ceilometer</code>. Ensure that the subscription address for each of these collectors is unique for every cloud, data type, and collector combination.</p>
</div>
<div class="paragraph">
<p>The default <code>cloud1</code> configuration is represented by the following <code>ServiceTelemetry</code> object, providing subscriptions and data storage of metrics and events for both collectd and Ceilometer data collectors for a particular cloud instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: infra.watch/v1beta1
kind: ServiceTelemetry
metadata:
  name: stf-default
  namespace: service-telemetry
spec:
  clouds:
    - name: cloud1
      metrics:
        collectors:
          - collectorType: collectd
            subscriptionAddress: collectd/telemetry
          - collectorType: ceilometer
            subscriptionAddress: anycast/ceilometer/metering.sample
      events:
        collectors:
          - collectorType: collectd
            subscriptionAddress: collectd/notify
          - collectorType: ceilometer
            subscriptionAddress: anycast/ceilometer/event.sample</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each item of the <code>clouds</code> parameter represents a cloud instance. The cloud instances are made up of 3 top-level parameters: <code>name</code>, <code>metrics</code>, and <code>events</code>. The metrics and events parameters represent the corresponding backend for storage of that data type. The <code>collectors</code> parameter then specifies a list of objects made up of two parameters, <code>collectorType</code> and <code>subscriptionAddress</code>, and these represent an instance of the Smart Gateway. The collectorType specifies data collected by either collectd or Ceilometer. The subscriptionAddress parameter provides the Apache&#160;Qpid&#160;Dispatch&#160;Router address that a Smart Gateway instance should subscribe to.</p>
</div>
</div>
<div class="sect4">
<h5 id="_alerting">alerting</h5>
<div class="paragraph">
<p>Use the <code>alerting</code> parameter to control creation of an <a href="https://prometheus.io/docs/alerting/latest/alertmanager/">Alertmanager</a> instance and the configuration of the storage backend. By default, <code>alerting</code> is enabled. For more information, see <a href="#alerts_advanced-features">Alerts</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_graphing">graphing</h5>
<div class="paragraph">
<p>Use the <code>graphing</code> parameter to control the creation of a <a href="https://grafana.com/docs/grafana/latest/getting-started/what-is-grafana/">Grafana</a> instance. By default, <code>graphing</code> is disabled. For more information, see <a href="#dashboards_advanced-features">Dashboards</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_highavailability">highAvailability</h5>
<div class="paragraph">
<p>Use The <code>highAvailability</code> parameter to control the instantiation of multiple copies of STF components to reduce recovery time of components that fail or are rescheduled. By default, <code>highAvailability</code> is disabled. For more information, see <a href="#high-availability_advanced-features">High availability</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_transports">transports</h5>
<div class="paragraph">
<p>Use the <code>transports</code> parameter to control the enablement of the message bus for a STF deployment. The only transport currently supported is Apache&#160;Qpid&#160;Dispatch&#160;Router. Ensure that it is enabled for proper operation of STF. By default, the <code>qdr</code> transport is enabled.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="creating-a-servicetelemetry-object-in-openshift">Creating a ServiceTelemetry object in OKD</h4>
<div class="paragraph">
<p>Create a <code>ServiceTelemetry</code> object in OKD to result in the creation of supporting components for a Service&#160;Telemetry&#160;Framework deployment. For more information, see <a href="#overview-of-the-servicetelemetry-object">Overview of the ServiceTelemetry object</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To create a <code>ServiceTelemetry</code> object that results in a default STF deployment, create a <code>ServiceTelemetry</code> object with an empty <code>spec</code> object:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc apply -f - &lt;&lt;EOF
apiVersion: infra.watch/v1beta1
kind: ServiceTelemetry
metadata:
  name: default
  namespace: service-telemetry
spec: {}
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>Creating a default <code>ServiceTelemetry</code> object results in a STF deployment with the following defaults:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: infra.watch/v1beta1
kind: ServiceTelemetry
metadata:
  name: default
spec:
  alerting:
    enabled: true
    alertmanager:
      storage:
        strategy: persistent
        persistent:
          storageSelector: {}
          pvcStorageRequest: 20G
  backends:
    metrics:
      prometheus:
        enabled: true
        scrapeInterval: 10s
        storage:
          strategy: persistent
          retention: 24h
          persistent:
            storageSelector: {}
            pvcStorageRequest: 20G
    events:
      elasticsearch:
        enabled: false
        storage:
          strategy: persistent
          persistent:
            pvcStorageRequest: 20Gi
  graphing:
    enabled: false
    grafana:
      ingressEnabled: false
      adminPassword: secret
      adminUser: root
      disableSignoutMenu: false
  transports:
    qdr:
      enabled: true
      web:
        enabled: false
  highAvailability:
    enabled: false
  clouds:
    - name: cloud1
      metrics:
        collectors:
          - collectorType: collectd
            subscriptionAddress: collectd/telemetry
          - collectorType: ceilometer
            subscriptionAddress: anycast/ceilometer/metering.sample
      events:
        collectors:
          - collectorType: collectd
            subscriptionAddress: collectd/notify
          - collectorType: ceilometer
            subscriptionAddress: anycast/ceilometer/event.sample</code></pre>
</div>
</div>
</li>
<li>
<p>Optional: To create a <code>ServiceTelemetry</code> object that results in collection and storage of events for the default cloud, enable the ElasticSearch backend:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ oc apply -f - &lt;&lt;EOF
apiVersion: infra.watch/v1beta1
kind: ServiceTelemetry
metadata:
  name: default
  namespace: service-telemetry
spec:
  backends:
    events:
      elasticsearch:
        enabled: true
EOF</code></pre>
</div>
</div>
</li>
<li>
<p>To view the STF deployment logs in the Service Telemetry Operator, use the <code>oc logs</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc logs --selector name=service-telemetry-operator -c ansible</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">PLAY RECAP <strong><strong></strong><strong></strong></strong><strong><strong></strong><strong></strong></strong><strong><strong></strong><strong></strong></strong><strong><strong></strong><strong></strong></strong><strong><strong></strong><strong></strong></strong><strong><strong></strong><strong></strong></strong><strong><strong></strong></strong>***
localhost                  : ok=55   changed=0    unreachable=0    failed=0    skipped=16   rescued=0    ignored=0</pre>
</div>
</div>
</li>
<li>
<p>View the pods and the status of each pod to determine that all workloads are operating nominally:</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you set <code>backends.events.elasticsearch.enabled: true</code>, the notification Smart Gateways reports <code>Error</code> and <code>CrashLoopBackOff</code> error messages for a period of time before ElasticSearch starts.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">$ oc get pods

NAME                                                      READY   STATUS    RESTARTS   AGE
alertmanager-default-0                                    2/2     Running   0          38s
default-cloud1-ceil-meter-smartgateway-58d8876857-lbf9d   1/1     Running   0          159m
default-cloud1-coll-meter-smartgateway-8645d64f5f-rxfpb   2/2     Running   0          159m
default-interconnect-79d9994b5-xnfvv                      1/1     Running   0          167m
elastic-operator-746f86c956-jkvcq                         1/1     Running   0          6h23m
interconnect-operator-5b474bdddc-sztsj                    1/1     Running   0          6h19m
prometheus-default-0                                      3/3     Running   1          5m39s
prometheus-operator-7dfb478c8b-bfd4j                      1/1     Running   0          6h19m
service-telemetry-operator-656fc8ccb6-4w8x4               2/2     Running   0          98m
smart-gateway-operator-7f49676d5d-nqzmp                   2/2     Running   0          6h21m</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="removing-stf-from-the-openshift-environment_installing-the-core-components-of-stf">Removing STF from the OKD environment</h3>
<div class="paragraph">
<p>Remove STF from an OKD environment if you no longer require the STF functionality.</p>
</div>
<div class="paragraph">
<p>Complete the following tasks:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#deleting-the-namespace">Deleting the namespace</a>.</p>
</li>
<li>
<p><a href="#removing-the-catalogsource">Removing the CatalogSource</a>.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="deleting-the-namespace">Deleting the namespace</h4>
<div class="paragraph">
<p>To remove the operational resources for STF from OKD, delete the namespace.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Run the <code>oc delete</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc delete project service-telemetry</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the resources have been deleted from the namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc get all
No resources found.</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="removing-the-catalogsource">Removing the CatalogSource</h4>
<div class="paragraph">
<p>If you do not expect to install Service&#160;Telemetry&#160;Framework again, delete the CatalogSource. When you remove the CatalogSource, PackageManifests related to STF are removed from the Operator Lifecycle Manager catalog.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Delete the CatalogSource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc delete --namespace=openshift-marketplace catalogsource infrawatch-operators
catalogsource.operators.coreos.com "infrawatch-operators" deleted</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the STF PackageManifests are removed from the platform. If successful, the following command returns no result:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc get packagemanifests | grep InfraWatch</code></pre>
</div>
</div>
</li>
<li>
<p>If you enabled the OperatorHub.io Community Catalog Source during the installation process and you no longer need this catalog source, delete it:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc delete --namespace=openshift-marketplace catalogsource operatorhubio-operators
catalogsource.operators.coreos.com "operatorhubio-operators" deleted</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>For more information about the OperatorHub.io Community Catalog Source, see <a href="#deploying-stf-to-the-openshift-environment_installing-the-core-components-of-stf">Deploying STF to the OKD environment</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="completing-the-stf-configuration_installing-the-core-components-of-stf">Completing the Service&#160;Telemetry&#160;Framework configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="connecting-openstack_completing-the-stf-configuration">Connecting OpenStack to Service&#160;Telemetry&#160;Framework</h3>
<div class="paragraph">
<p>To collect metrics, events, or both, and to send them to the Service&#160;Telemetry&#160;Framework (STF) storage domain, you must configure the OpenStack overcloud to enable data collection and transport.</p>
</div>
<div class="paragraph">
<p>To deploy data collection and transport to STF on OpenStack cloud nodes that employ routed L3 domains, such as distributed compute node (DCN) or spine-leaf, see <a href="#deploying-to-non-standard-network-topologies_completing-the-stf-configuration">Deploying to non-standard network topologies</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="deploying-to-non-standard-network-topologies_completing-the-stf-configuration">Deploying to non-standard network topologies</h3>
<div class="paragraph">
<p>If your nodes are on a separate network from the default <code>InternalApi</code> network, you must make configuration adjustments so that Apache&#160;Qpid&#160;Dispatch&#160;Router can transport data to the Service&#160;Telemetry&#160;Framework (STF) server instance. This scenario is typical in a spine-leaf or a DCN topology. For more information about DCN configuration, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html-single/spine_leaf_networking/">Spine Leaf Networking</a> guide.</p>
</div>
<div class="paragraph">
<p>If you use STF with OpenStack Train  and plan to monitor your Ceph, Block, or Object storage nodes, you must make configuration changes that are similar to the configuration changes that you make to the spine-leaf and DCN network configuration. To monitor Ceph nodes, use the <code>CephStorageExtraConfig</code> parameter to define which network interface to load into the Apache&#160;Qpid&#160;Dispatch&#160;Router and collectd configuration files.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">  CephStorageExtraConfig:
      tripleo::profile::base::metrics::collectd::amqp_host: "%{hiera('storage')}"
      tripleo::profile::base::metrics::qdr::listener_addr: "%{hiera('storage')}"
      tripleo::profile::base::ceilometer::agent::notification::notifier_host_addr: "%{hiera('storage')}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, you must specify  <code>BlockStorageExtraConfig</code> and <code>ObjectStorageExtraConfig</code> parameters if your environment uses  Block and Object storage roles.</p>
</div>
<div class="paragraph">
<p>The deployment of a spine-leaf topology involves creating roles and networks, then assigning those networks to the available roles. When you configure data collection and transport for STF for an OpenStack deployment, the default network for roles is <code>InternalApi</code>. For Ceph, Block and Object storage roles, the default network is <code>Storage</code>.
Because a spine-leaf configuration can result in different networks being assigned to different Leaf groupings and those names are typically unique, additional configuration is required in the <code>parameter_defaults</code> section of the OpenStack  environment files.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Document which networks are available for each of the Leaf roles. For examples of network name definitions, see <a href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html-single/spine_leaf_networking/index#creating-a-network-data-file">Creating a network data file</a> in the <em>Spine Leaf Networking</em> guide. For more information about the creation of the Leaf groupings (roles) and assignment of the networks to those groupings, see <a href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html-single/spine_leaf_networking/index#creating-a-roles-data-file">Creating a roles data file</a> in the <em>Spine Leaf Networking</em> guide.</p>
</li>
<li>
<p>Add the following configuration example to the <code>ExtraConfig</code> section for each of the leaf roles. In this example,
<code>internal_api_subnet</code>
is the value defined in the <code>name_lower</code> parameter of your network definition
(with <code>_subnet</code> appended to the name for Leaf 0)
, and is the network to which the
<code>ComputeLeaf0</code>
leaf role is connected. In this case, the network identification of 0 corresponds to the Compute role for leaf 0, and represents a value that is different from the default internal API network name.</p>
<div class="paragraph">
<p>For the
<code>ComputeLeaf0</code>
leaf role, specify extra configuration to perform a hiera lookup to determine which network interface for a particular network to assign to the collectd AMQP host parameter. Perform the same configuration for the Apache&#160;Qpid&#160;Dispatch&#160;Router listener address parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">ComputeLeaf0ExtraConfig:
   tripleo::profile::base::metrics::collectd::amqp_host: "%{hiera('internal_api_subnet')}"
   tripleo::profile::base::metrics::qdr::listener_addr: "%{hiera('internal_api_subnet')}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Additional leaf roles typically replace <code>_subnet</code> with <code>_leafN</code> where <code>N</code> represents a unique indentifier for the leaf.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">ComputeLeaf1ExtraConfig:
   tripleo::profile::base::metrics::collectd::amqp_host: "%{hiera('internal_api_leaf1')}"
   tripleo::profile::base::metrics::qdr::listener_addr: "%{hiera('internal_api_leaf1')}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example configuration is on a CephStorage leaf role:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">CephStorageLeaf0ExtraConfig:
   tripleo::profile::base::metrics::collectd::amqp_host: "%{hiera('storage_subnet')}"
   tripleo::profile::base::metrics::qdr::listener_addr: "%{hiera('storage_subnet')}"</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-red-hat-openstack-platform-overcloud-for-stf_completing-the-stf-configuration">Configuring OpenStack overcloud for Service&#160;Telemetry&#160;Framework</h3>
<div class="paragraph">
<p>To configure the OpenStack overcloud, you must configure the data collection applications and the data transport to STF, and deploy the overcloud.</p>
</div>
<div class="paragraph">
<p>To configure the OpenStack overcloud, complete the following tasks:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#retrieving-the-qdr-route-address">Retrieving the Apache&#160;Qpid&#160;Dispatch&#160;Router route address</a></p>
</li>
<li>
<p><a href="#configuring-the-stf-connection-for-the-overcloud">Configuring the STF connection for the overcloud</a></p>
</li>
<li>
<p><a href="#validating-clientside-installation_completing-the-stf-configuration">Validating client-side installation</a></p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>To collect data through Apache&#160;Qpid&#160;Dispatch&#160;Router, see <a href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html-single/monitoring_tools_configuration_guide/index#amqp1">The amqp1 plug-in</a> in the <em>Monitoring Tools Configuration</em> guide.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="retrieving-the-qdr-route-address">Retrieving the Apache&#160;Qpid&#160;Dispatch&#160;Router route address</h4>
<div class="paragraph">
<p>When you configure the OpenStack overcloud for STF, you must provide the Apache&#160;Qpid&#160;Dispatch&#160;Router route address in the STF connection file.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to your OpenShift (OKD) environment.</p>
</li>
<li>
<p>In the <code>service-telemetry</code> project, retrieve the Apache&#160;Qpid&#160;Dispatch&#160;Router route address:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">$ oc get routes -ogo-template='{{ range .items }}{{printf "%s\n" .spec.host }}{{ end }}' | grep "\-5671"
default-interconnect-5671-service-telemetry.apps.infra.watch</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If your STF installation differs from the documentation, ensure that you retrieve the correct Apache&#160;Qpid&#160;Dispatch&#160;Router route address.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-the-stf-connection-for-the-overcloud">Configuring the STF connection for the overcloud</h4>
<div class="paragraph">
<p>To configure the STF connection, you must create a file that contains the connection configuration of the Apache&#160;Qpid&#160;Dispatch&#160;Router for the overcloud to the STF deployment. Enable the collection of events and storage of the events in STF and deploy the overcloud.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to the OpenStack undercloud as the <code>stack</code> user.</p>
</li>
<li>
<p>Create a configuration file called <code>stf-connectors.yaml</code> in the <code>/home/stack</code> directory.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Service Telemetry Operator simplifies the deployment of all data ingestion and data storage components for single cloud deployments. To share the data storage domain with multiple clouds, see <a href="#configuring-multiple-clouds_advanced-features">Multiple cloud configuration</a>.</p>
</div>
<div class="paragraph">
<p>Additionally, setting <code>EventPipelinePublishers</code> and <code>MetricPipelinePublishers</code> to empty lists results in no metric or event data passing to OpenStack legacy telemetry components, such as Gnocchi or Panko. If you need to send data to additional pipelines, the Ceilometer polling interval of 5 seconds as specified in <code>ExtraConfig</code> might overwhelm the legacy components. If you configure a longer polling interval, you must also modify STF to avoid stale metrics, resulting in what appears to be missing data in Prometheus.</p>
</div>
<div class="paragraph">
<p>If an adjustment needs to be made to the polling interval, then modify the ServiceTelemetry object <code>backends.metrics.prometheus.scrapeInterval</code> parameter from the default value of <code>10s</code> to double the polling interval of the data collectors. For example, if <code>CollectdAmqpInterval</code> and <code>ceilometer::agent::polling::polling_interval</code> are adjusted to <code>30</code> then set the <code>backends.metrics.prometheus.scrapeInterval</code> to a value of <code>60s</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>In the <code>stf-connectors.yaml</code> file, configure the <code>MetricsQdrConnectors</code> address to connect the Apache&#160;Qpid&#160;Dispatch&#160;Router on the overcloud to the STF deployment.</p>
<div class="ulist">
<ul>
<li>
<p>Add the <code>CeilometerQdrPublishMetrics: true</code> parameter to enable collection and transport of Ceilometer metrics to STF.</p>
</li>
<li>
<p>Add the <code>CeilometerQdrPublishEvents: true</code> parameter to enable collection and transport of Ceilometer events to STF.</p>
</li>
<li>
<p>Add the <code>EventPiplinePublishers: []</code> and <code>MetricPipelinePublishers: []</code> to avoid writing data to Gnocchi and Panko.</p>
</li>
<li>
<p>Add the <code>ManagePolling: true</code> and <code>ManagePipeline: true</code> parameters to allow full control of Ceilometer polling and pipeline configuration.</p>
</li>
<li>
<p>Add the <code>ExtraConfig</code> parameter <code>ceilometer::agent::polling::polling_interval</code> to set the polling interval of Ceilometer to be compatible with the default STF scrape interval.</p>
</li>
<li>
<p>Replace the <code>host</code> parameter with the value of <code>HOST/PORT</code> that you retrieved in <a href="#retrieving-the-qdr-route-address">Retrieving the Apache&#160;Qpid&#160;Dispatch&#160;Router route address</a>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">parameter_defaults:
    EventPipelinePublishers: []
    MetricPipelinePublishers: []
    CeilometerQdrPublishEvents: true
    CeilometerQdrPublishMetrics: true
    MetricsQdrConnectors:
    - host: default-interconnect-5671-service-telemetry.apps.infra.watch
      port: 443
      role: edge
      sslProfile: sslProfile
      verifyHostname: false
    ExtraConfig:
      ceilometer::agent::polling::polling_interval: 5</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Add the following files to your OpenStack TripleO deployment to setup collectd and Apache&#160;Qpid&#160;Dispatch&#160;Router:</p>
<div class="ulist">
<ul>
<li>
<p>the <code>stf-connectors.yaml</code> environment file</p>
</li>
<li>
<p>the <code>enable-stf.yaml</code> file that ensures that the environment is being used during the overcloud deployment</p>
</li>
<li>
<p>the <code>ceilometer-write-qdr.yaml</code> file that ensures that Ceilometer telemetry is sent to STF</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">openstack overcloud deploy &lt;other arguments&gt;
  --templates /usr/share/openstack-tripleo-heat-templates \
  --environment-file &lt;...other-environment-files...&gt; \
  --environment-file /usr/share/openstack-tripleo-heat-templates/environments/metrics/ceilometer-write-qdr.yaml \
  --environment-file /usr/share/openstack-tripleo-heat-templates/environments/enable-stf.yaml \
  --environment-file /home/stack/stf-connectors.yaml</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Deploy the OpenStack overcloud.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="validating-clientside-installation_completing-the-stf-configuration">Validating client-side installation</h4>
<div class="paragraph">
<p>To validate data collection from the STF storage domain, query the data sources for delivered data. To validate individual nodes in the OpenStack deployment, connect to the console using SSH.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Some telemetry data is only available when OpenStack has active workloads.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to an overcloud node, for example, controller-0.</p>
</li>
<li>
<p>Ensure that <code>metrics_qdr</code> container is running on the node:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">$ sudo podman container inspect --format '{{.State.Status}}' metrics_qdr

running</code></pre>
</div>
</div>
</li>
<li>
<p>Return the internal network address on which Apache&#160;Qpid&#160;Dispatch&#160;Router is running, for example, <code>172.17.1.44</code> listening on port <code>5666</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">$ sudo podman exec -it metrics_qdr cat /etc/qpid-dispatch/qdrouterd.conf

listener {
    host: 172.17.1.44
    port: 5666
    authenticatePeer: no
    saslMechanisms: ANONYMOUS
}</code></pre>
</div>
</div>
</li>
<li>
<p>Return a list of connections to the local Apache&#160;Qpid&#160;Dispatch&#160;Router:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">$ sudo podman exec -it metrics_qdr qdstat --bus=172.17.1.44:5666 --connections

Connections
  id   host                                                                  container                                                                                                  role    dir  security                            authentication  tenant
  ============================================================================================================================================================================================================================================================================================
  1    default-interconnect-5671-service-telemetry.apps.infra.watch:443      default-interconnect-7458fd4d69-bgzfb                                                                      edge    out  TLSv1.2(DHE-RSA-AES256-GCM-SHA384)  anonymous-user
  12   172.17.1.44:60290                                                     openstack.org/om/container/controller-0/ceilometer-agent-notification/25/5c02cee550f143ec9ea030db5cccba14  normal  in   no-security                         no-auth
  16   172.17.1.44:36408                                                     metrics                                                                                                    normal  in   no-security                         anonymous-user
  899  172.17.1.44:39500                                                     10a2e99d-1b8a-4329-b48c-4335e5f75c84                                                                       normal  in   no-security                         no-auth</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are four connections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Outbound connection to STF</p>
</li>
<li>
<p>Inbound connection from ceilometer</p>
</li>
<li>
<p>Inbound connection from collectd</p>
</li>
<li>
<p>Inbound connection from our <code>qdstat</code> client</p>
<div class="paragraph">
<p>The outbound STF connection is provided to the <code>MetricsQdrConnectors</code> host parameter and is the route for the STF storage domain. The other hosts are internal network addresses of the client connections to this Apache&#160;Qpid&#160;Dispatch&#160;Router.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>To ensure that messages are being delivered, list the links, and view the <code>_edge</code> address in the <code>deliv</code> column for delivery of messages:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">$ sudo podman exec -it metrics_qdr qdstat --bus=172.17.1.44:5666 --links
Router Links
  type      dir  conn id  id    peer  class   addr                  phs  cap  pri  undel  unsett  deliv    presett  psdrop  acc  rej  rel     mod  delay  rate
  ===========================================================================================================================================================
  endpoint  out  1        5           local   _edge                      250  0    0      0       2979926  0        0       0    0    2979926 0    0      0
  endpoint  in   1        6                                              250  0    0      0       0        0        0       0    0    0       0    0      0
  endpoint  in   1        7                                              250  0    0      0       0        0        0       0    0    0       0    0      0
  endpoint  out  1        8                                              250  0    0      0       0        0        0       0    0    0       0    0      0
  endpoint  in   1        9                                              250  0    0      0       0        0        0       0    0    0       0    0      0
  endpoint  out  1        10                                             250  0    0      0       911      911      0       0    0    0       0    911    0
  endpoint  in   1        11                                             250  0    0      0       0        911      0       0    0    0       0    0      0
  endpoint  out  12       32          local   temp.lSY6Mcicol4J2Kp       250  0    0      0       0        0        0       0    0    0       0    0      0
  endpoint  in   16       41                                             250  0    0      0       2979924  0        0       0    0    2979924 0    0      0
  endpoint  in   912      1834        mobile  $management           0    250  0    0      0       1        0        0       1    0    0       0    0      0
  endpoint  out  912      1835        local   temp.9Ok2resI9tmt+CT       250  0    0      0       0        0        0       0    0    0       0    0      0</code></pre>
</div>
</div>
</li>
<li>
<p>To list the addresses from OpenStack nodes to STF, connect to OKD to get the Apache&#160;Qpid&#160;Dispatch&#160;Router pod name and list the connections. List the available Apache&#160;Qpid&#160;Dispatch&#160;Router pods:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc get pods -l application=default-interconnect

NAME                                    READY   STATUS    RESTARTS   AGE
default-interconnect-7458fd4d69-bgzfb   1/1     Running   0          6d21h</code></pre>
</div>
</div>
</li>
<li>
<p>Connect to the pod and run the <code>qdstat --connections</code> command to list the known connections:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">$ oc exec -it default-interconnect-7458fd4d69-bgzfb -- qdstat --connections

2020-04-21 18:25:47.243852 UTC
default-interconnect-7458fd4d69-bgzfb

Connections
  id  host               container                                                      role    dir  security                                authentication  tenant  last dlv      uptime
  ===============================================================================================================================================================================================
  5   10.129.0.110:48498  bridge-3f5                                                    edge    in   no-security                             anonymous-user          000:00:00:02  000:17:36:29
  6   10.129.0.111:43254  rcv[default-cloud1-ceil-meter-smartgateway-58f885c76d-xmxwn]  edge    in   no-security                             anonymous-user          000:00:00:02  000:17:36:20
  7   10.130.0.109:50518  rcv[default-cloud1-coll-event-smartgateway-58fbbd4485-rl9bd]  normal  in   no-security                             anonymous-user          -             000:17:36:11
  8   10.130.0.110:33802  rcv[default-cloud1-ceil-event-smartgateway-6cfb65478c-g5q82]  normal  in   no-security                             anonymous-user          000:01:26:18  000:17:36:05
  22  10.128.0.1:51948   Router.ceph-0.redhat.local                                     edge    in   TLSv1/SSLv3(DHE-RSA-AES256-GCM-SHA384)  anonymous-user          000:00:00:03  000:22:08:43
  23  10.128.0.1:51950   Router.compute-0.redhat.local                                  edge    in   TLSv1/SSLv3(DHE-RSA-AES256-GCM-SHA384)  anonymous-user          000:00:00:03  000:22:08:43
  24  10.128.0.1:52082   Router.controller-0.redhat.local                               edge    in   TLSv1/SSLv3(DHE-RSA-AES256-GCM-SHA384)  anonymous-user          000:00:00:00  000:22:08:34
  27  127.0.0.1:42202    c2f541c1-4c97-4b37-a189-a396c08fb079                           normal  in   no-security                             no-auth                 000:00:00:00  000:00:00:00</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, there are three <code>edge</code> connections from the OpenStack nodes with connection <code>id</code> 22, 23, and 24.</p>
</div>
</li>
<li>
<p>To view the number of messages delivered by the network, use each address with the <code>oc exec</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">$ oc exec -it default-interconnect-7458fd4d69-bgzfb -- qdstat --address

2020-04-21 18:20:10.293258 UTC
default-interconnect-7458fd4d69-bgzfb

Router Addresses
  class   addr                                phs  distrib    pri  local  remote  in           out          thru  fallback
  ==========================================================================================================================
  mobile  anycast/ceilometer/event.sample     0    balanced   -    1      0       970          970          0     0
  mobile  anycast/ceilometer/metering.sample  0    balanced   -    1      0       2,344,833    2,344,833    0     0
  mobile  collectd/notify                     0    multicast  -    1      0       70           70           0     0
  mobile  collectd/telemetry                  0    multicast  -    1      0       216,128,890  216,128,890  0     0</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advanced-features_completing-the-stf-configuration">Advanced features</h2>
<div class="sectionbody">
<div id="advanced-features_advanced-features" class="paragraph">
<p>The following optional features can provide additional functionality to the Service&#160;Telemetry&#160;Framework (STF):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#manifest-overrides_advanced-features">Customizing the deployment</a></p>
</li>
<li>
<p><a href="#alerts_advanced-features">Alerts</a></p>
</li>
<li>
<p><a href="#configuring-snmp-traps_advanced-features">Configuring SNMP Traps</a></p>
</li>
<li>
<p><a href="#high-availability_advanced-features">High availability</a></p>
</li>
<li>
<p><a href="#dashboards_advanced-features">Dashboards</a></p>
</li>
<li>
<p><a href="#configuring-multiple-clouds_advanced-features">Multiple cloud configuration</a></p>
</li>
<li>
<p><a href="#ephemeral-storage_advanced-features">Ephemeral storage</a></p>
</li>
<li>
<p><a href="#monitoring-resource-usage-of-openstack-services_advanced-features">Monitoring the resource usage of OpenStack services</a></p>
</li>
<li>
<p><a href="#exposing-routes_advanced-features">Creating a route in OpenShift</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="manifest-overrides_advanced-features">Customizing the deployment</h3>
<div class="paragraph">
<p>The Service Telemetry Operator watches for a <code>ServiceTelemetry</code> manifest to load into OpenShift (OKD). The Operator then creates other objects in memory, which results in the dependent Operators creating the workloads they are responsible for managing.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When you override the manifest, you must provide the entire manifest contents, including object names or namespaces. There is no dynamic parameter substitution when you override a manifest.</p>
</div>
<div class="paragraph">
<p>Use manifest overrides only as a last resort short circuit.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To override a manifest successfully with Service&#160;Telemetry&#160;Framework (STF), deploy a default environment using the core options only. For more information about the core options, see <a href="#creating-a-servicetelemetry-object-in-openshift">Creating a ServiceTelemetry object in OKD</a>. When you deploy STF, use the <code>oc get</code> command to retrieve the default deployed manifest. When you use a manifest that was originally generated by Service Telemetry Operator, the manifest is compatible with the other objects that are managed by the Operators.</p>
</div>
<div class="paragraph">
<p>For example, when the <code>backends.metrics.prometheus.enabled: true</code> parameter is configured in the <code>ServiceTelemetry</code> manifest, the Service Telemetry Operator requests components for metrics retrieval and storage using the default manifests. In some cases, you might want to override the default manifest. For more information, see <a href="#manifest-override-parameters_advanced-features">Manifest override parameters</a>.</p>
</div>
<div class="sect3">
<h4 id="manifest-override-parameters_advanced-features">Manifest override parameters</h4>
<div class="paragraph">
<p>This table describes the available parameters that you can use to override a manifest, along with the corresponding retrieval commands.</p>
</div>
<table id="table-manifest-override-parameters" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Manifest override parameters</caption>
<colgroup>
<col style="width: 33.3333%;"/>
<col style="width: 33.3333%;"/>
<col style="width: 33.3334%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Override parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Retrieval command</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>alertmanagerManifest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Override the <code>Alertmanager</code> object creation. The Prometheus Operator watches for <code>Alertmanager</code> objects.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>oc get alertmanager default -oyaml</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>alertmanagerConfigManifest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Override the <code>Secret</code> that contains the Alertmanager configuration. The Prometheus Operator uses a secret named <code>alertmanager-{{ alertmanager-name }}</code>, for example, <code>default</code>, to provide the <code>alertmanager.yaml</code> configuration to Alertmanager.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>oc get secret alertmanager-default -oyaml</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>elasticsearchManifest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Override the <code>ElasticSearch</code> object creation. The Elastic Cloud on Kuberneters Operator watches for <code>ElasticSearch</code> objects.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>oc get elasticsearch elasticsearch -oyaml</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>interconnectManifest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Override the <code>Interconnect</code> object creation. The AMQ Interconnect Operator watches for <code>Interconnect</code> objects.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>oc get interconnect default-interconnect -oyaml</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>prometheusManifest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Override the <code>Prometheus</code> object creation. The Prometheus Operator watches for <code>Prometheus</code> objects.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>oc get prometheus default -oyaml</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>servicemonitorManifest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Override the <code>ServiceMonitor</code> object creation. The Prometheus Operator watches for <code>ServiceMonitor</code> objects.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>oc get servicemonitor default -oyaml</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="configuring-manifest-overrides_advanced-features">Overriding a managed manifest</h4>
<div class="paragraph">
<p>Edit the <code>ServiceTelemetry</code> object and provide a parameter and manifest. For a list of available manifest override parameters, see <a href="#manifest-overrides_advanced-features">Customizing the deployment</a>. The default <code>ServiceTelemetry</code> object is <code>default</code>. Use <code>oc get servicetelemetry</code> to list the available STF deployments.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>oc edit</code> command loads the default system editor. To override the default editor, pass or set the environment variable <code>EDITOR</code> to the preferred editor. For example, <code>EDITOR=nano oc edit servicetelemetry default</code>.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to OpenShift.</p>
</li>
<li>
<p>Change to the <code>service-telemetry</code> namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc project service-telemetry</code></pre>
</div>
</div>
</li>
<li>
<p>Load the <code>ServiceTelemetry</code> object into an editor:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc edit servicetelemetry default</code></pre>
</div>
</div>
</li>
<li>
<p>To modify the <code>ServiceTelemetry</code> object, provide a manifest override parameter and the contents of the manifest to write to OKD instead of the defaults provided by STF.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The trailing pipe (<code>|</code>) after entering the manifest override parameter indicates that the value provided is multi-line.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">$ oc edit stf default

apiVersion: infra.watch/v1beta1
kind: ServiceTelemetry
metadata:
  ...
spec:
  alertmanagerConfigManifest: | <i class="conum" data-value="1"></i><b>(1)</b>
    apiVersion: v1
    kind: Secret
    metadata:
      name: 'alertmanager-default'
      namespace: 'service-telemetry'
    type: Opaque
    stringData:
      alertmanager.yaml: |-
        global:
          resolve_timeout: 10m
        route:
          group_by: ['job']
          group_wait: 30s
          group_interval: 5m
          repeat_interval: 12h
          receiver: 'null'
        receivers:
        - name: 'null' <i class="conum" data-value="2"></i><b>(2)</b>
status:
  ...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Manifest override parameter is defined in the <code>spec</code> of the <code>ServiceTelemetry</code> object.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>End of the manifest override content.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Save and close.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="alerts_advanced-features">Alerts</h3>
<div class="paragraph">
<p>You create alert rules in Prometheus and alert routes in Alertmanager. Alert rules in Prometheus servers send alerts to an Alertmanager, which manages the alerts. Alertmanager can silence, inhibit, or aggregate alerts, and send notifications using email, on-call notification systems, or chat platforms.</p>
</div>
<div class="paragraph">
<p>To create an alert, complete the following tasks:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create an alert rule in Prometheus. For more information, see <a href="#creating-an-alert-rule-in-prometheus_advanced-features">Creating an alert rule in Prometheus</a>.</p>
</li>
<li>
<p>Create an alert route in Alertmanager. For more information, see <a href="#creating-an-alert-route-in-alertmanager_advanced-features">Creating an alert route in Alertmanager</a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>For more information about alerts or notifications with Prometheus and Alertmanager, see <a href="https://prometheus.io/docs/alerting/overview/" class="bare">https://prometheus.io/docs/alerting/overview/</a></p>
</div>
<div class="paragraph">
<p>To view an example set of alerts that you can use with Service&#160;Telemetry&#160;Framework (STF), see <a href="https://github.com/infrawatch/service-telemetry-operator/tree/master/deploy/alerts" class="bare">https://github.com/infrawatch/service-telemetry-operator/tree/master/deploy/alerts</a></p>
</div>
<div class="sect3">
<h4 id="creating-an-alert-rule-in-prometheus_advanced-features">Creating an alert rule in Prometheus</h4>
<div class="paragraph">
<p>Prometheus evaluates alert rules to trigger notifications. If the rule condition returns an empty result set, the condition is false. Otherwise, the rule is true and it triggers an alert.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to OpenShift.</p>
</li>
<li>
<p>Change to the <code>service-telemetry</code> namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc project service-telemetry</code></pre>
</div>
</div>
</li>
<li>
<p>Create a <code>PrometheusRule</code> object that contains the alert rule. The Prometheus Operator loads the rule into Prometheus:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">$ oc apply -f - &lt;&lt;EOF
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  creationTimestamp: null
  labels:
    prometheus: default
    role: alert-rules
  name: prometheus-alarm-rules
  namespace: service-telemetry
spec:
  groups:
    - name: ./openstack.rules
      rules:
        - alert: Metric Listener down
          expr: collectd_qpid_router_status &lt; 1 # To change the rule, edit the value of the expr parameter.
EOF</code></pre>
</div>
</div>
</li>
<li>
<p>To verify that the rules have been loaded into Prometheus by the Operator, create a pod with access to <code>curl</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc run curl --generator=run-pod/v1 --image=radial/busyboxplus:curl -i --tty</code></pre>
</div>
</div>
</li>
<li>
<p>Run <code>curl</code> to access the <code>prometheus-operated</code> service to return the rules loaded into memory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">[ root@curl:/ ]$ curl prometheus-operated:9090/api/v1/rules
{"status":"success","data":{"groups":[{"name":"./openstack.rules","file":"/etc/prometheus/rules/prometheus-default-rulefiles-0/service-telemetry-prometheus-alarm-rules.yaml","rules":[{"name":"Metric Listener down","query":"collectd_qpid_router_status \u003c 1","duration":0,"labels":{},"annotations":{},"alerts":[],"health":"ok","type":"alerting"}],"interval":30}]}}</code></pre>
</div>
</div>
</li>
<li>
<p>To verify that the output shows the rules loaded into the <code>PrometheusRule</code> object, for example the output contains the defined <code>./openstack.rules</code>, exit from the pod:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[ root@curl:/ ]$ exit</code></pre>
</div>
</div>
</li>
<li>
<p>Clean up the environment by deleting the <code>curl</code> pod:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc delete pod curl

pod "curl" deleted</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>For more information on alerting, see <a href="https://github.com/coreos/prometheus-operator/blob/master/Documentation/user-guides/alerting.md" class="bare">https://github.com/coreos/prometheus-operator/blob/master/Documentation/user-guides/alerting.md</a></p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-custom-alerts_advanced-features">Configuring custom alerts</h4>
<div class="paragraph">
<p>You can add custom alerts to the <code>PrometheusRule</code> object that you created in <a href="#creating-an-alert-rule-in-prometheus_advanced-features">Creating an alert rule in Prometheus</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Use the <code>oc edit</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc edit prometheusrules prometheus-alarm-rules</code></pre>
</div>
</div>
</li>
<li>
<p>Edit the PrometheusRules manifest.</p>
</li>
<li>
<p>Save and close.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about configuring alerting rules, see <a href="https://prometheus.io/docs/prometheus/latest/configuration/alerting_rules/" class="bare">https://prometheus.io/docs/prometheus/latest/configuration/alerting_rules/</a>.</p>
</li>
<li>
<p>For more information about PrometheusRules objects, see <a href="https://github.com/coreos/prometheus-operator/blob/master/Documentation/user-guides/alerting.md" class="bare">https://github.com/coreos/prometheus-operator/blob/master/Documentation/user-guides/alerting.md</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="creating-an-alert-route-in-alertmanager_advanced-features">Creating an alert route in Alertmanager</h4>
<div class="paragraph">
<p>Use Alertmanager to deliver alerts to an external system, such as email, IRC, or other notification channel. The Prometheus Operator manages the Alertmanager configuration as an OpenShift (OKD) secret. STF by default deploys a basic configuration that results in no receivers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">alertmanager.yaml: |-
  global:
    resolve_timeout: 5m
  route:
    group_by: ['job']
    group_wait: 30s
    group_interval: 5m
    repeat_interval: 12h
    receiver: 'null'
  receivers:
  - name: 'null'</code></pre>
</div>
</div>
<div class="paragraph">
<p>To deploy a custom Alertmanager route with STF, an <code>alertmanagerConfigManifest</code> parameter must be passed to the Service Telemetry Operator that results in an updated secret, managed by the Prometheus Operator. For more information, see <a href="#configuring-manifest-overrides_advanced-features">Overriding a managed manifest</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to OpenShift.</p>
</li>
<li>
<p>Change to the <code>service-telemetry</code> namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc project service-telemetry</code></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>ServiceTelemetry</code> object for your STF deployment</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc edit stf default</code></pre>
</div>
</div>
</li>
<li>
<p>Add a new parameter, <code>alertmanagerConfigManifest</code>, and the <code>Secret</code> object contents to define the <code>alertmanager.yaml</code> configuration for Alertmanager:</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This step loads the default template that is already managed by Service Telemetry Operator. To verify that the changes are populating correctly, change a value, return the <code>alertmanager-default</code> secret, and verify that the new value is loaded into memory. For example, change the value <code>global.resolve_timeout</code> from <code>5m</code> to <code>10m</code>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: infra.watch/v1beta1
kind: ServiceTelemetry
metadata:
  name: default
  namespace: service-telemetry
spec:
  backends:
    metrics:
      prometheus:
        enabled: true
  alertmanagerConfigManifest: |
    apiVersion: v1
    kind: Secret
    metadata:
      name: 'alertmanager-default'
      namespace: 'service-telemetry'
    type: Opaque
    stringData:
      alertmanager.yaml: |-
        global:
          resolve_timeout: 10m
        route:
          group_by: ['job']
          group_wait: 30s
          group_interval: 5m
          repeat_interval: 12h
          receiver: 'null'
        receivers:
        - name: 'null'</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the configuration was applied to the secret:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">$ oc get secret alertmanager-default -o go-template='{{index .data "alertmanager.yaml" | base64decode }}'

global:
  resolve_timeout: 10m
route:
  group_by: ['job']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 12h
  receiver: 'null'
receivers:
- name: 'null'</code></pre>
</div>
</div>
</li>
<li>
<p>To verify the configuration has been loaded into Alertmanager, create a pod with access to <code>curl</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc run curl --generator=run-pod/v1 --image=radial/busyboxplus:curl -i --tty</code></pre>
</div>
</div>
</li>
<li>
<p>Run <code>curl</code> against the <code>alertmanager-operated</code> service to retrieve the status and <code>configYAML</code> contents and review the supplied configuration matches the configuration loaded into Alertmanager:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">[ root@curl:/ ]$ curl alertmanager-operated:9093/api/v1/status

{"status":"success","data":{"configYAML":"global:\n  resolve_timeout: 10m\n  http_config: {}\n  smtp_hello: localhost\n  smtp_require_tls: true\n  pagerduty_url: https://events.pagerduty.com/v2/enqueue\n  hipchat_api_url: https://api.hipchat.com/\n  opsgenie_api_url: https://api.opsgenie.com/\n  wechat_api_url: https://qyapi.weixin.qq.com/cgi-bin/\n  victorops_api_url: https://alert.victorops.com/integrations/generic/20131114/alert/\nroute:\n  receiver: \"null\"\n  group_by:\n  - job\n  group_wait: 30s\n  group_interval: 5m\n  repeat_interval: 12h\nreceivers:\n- name: \"null\"\ntemplates: []\n",...}}</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the <code>configYAML</code> field contains the expected changes. Exit from the pod:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[ root@curl:/ ]$ exit</code></pre>
</div>
</div>
</li>
<li>
<p>To clean up the environment, delete the <code>curl</code> pod:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc delete pod curl

pod "curl" deleted</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the OpenShift secret and the Prometheus operator, see <a href="https://github.com/coreos/prometheus-operator/blob/master/Documentation/user-guides/alerting.md">Alerting</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-snmp-traps_advanced-features">Configuring SNMP Traps</h3>
<div class="paragraph">
<p>You can integrate Service&#160;Telemetry&#160;Framework (STF) with an existing infrastructure monitoring platform that receives notifications via SNMP traps. To enable SNMP traps, modify the <code>ServiceTelemetry</code> object and configure the <code>snmpTraps</code> parameters.</p>
</div>
<div class="paragraph">
<p>For more information about configuring alerts, see <a href="#alerts_advanced-features">Alerts</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Know the IP address or hostname of the SNMP trap receiver where you want to send the alerts</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To enable SNMP traps, modify the <code>ServiceTelemetry</code> object:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc edit stf default</code></pre>
</div>
</div>
</li>
<li>
<p>Set the <code>alerting.alertmanager.receivers.snmpTraps</code> parameters:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: infra.watch/v1beta1
kind: ServiceTelemetry
...
spec:
  ...
  alerting:
    alertmanager:
      receivers:
        snmpTraps:
          enabled: true
          target: 10.10.10.10</code></pre>
</div>
</div>
</li>
<li>
<p>Ensure that you set the value of <code>target</code> to the IP address or hostname of the SNMP trap receiver.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="high-availability_advanced-features">High availability</h3>
<div class="paragraph">
<p>High availability is the ability of Service&#160;Telemetry&#160;Framework (STF) to rapidly recover from failures in its component services. Although OpenShift (OKD) restarts a failed pod if nodes are available to schedule the workload, this recovery process might take more than one minute, during which time events and metrics are lost. A high availability configuration includes multiple copies of STF components, reducing recovery time to approximately 2 seconds. To protect against failure of an OKD node, deploy STF to an OKD cluster with three or more nodes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
STF is not yet a fully fault tolerant system. Delivery of metrics and events during the recovery period is not guaranteed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Enabling high availability has the following effects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Three ElasticSearch pods run instead of the default one.</p>
</li>
<li>
<p>The following components run two pods instead of the default one:</p>
<div class="ulist">
<ul>
<li>
<p>Apache&#160;Qpid&#160;Dispatch&#160;Router</p>
</li>
<li>
<p>Alertmanager</p>
</li>
<li>
<p>Prometheus</p>
</li>
<li>
<p>Events Smart Gateway</p>
</li>
<li>
<p>Collectd Metrics Smart Gateway</p>
</li>
</ul>
</div>
</li>
<li>
<p>Recovery time from a lost pod in any of these services reduces to approximately 2 seconds.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Ceilometer Metrics Smart Gateway is not yet HA
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="configuring-high-availability_advanced-features">Configuring high availability</h4>
<div class="paragraph">
<p>To configure STF for high availability, add <code>highAvailability.enabled: true</code> to the ServiceTelemetry object in OKD. You can this set this parameter at installation time or, if you already deployed STF, complete the following steps:</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to OpenShift.</p>
</li>
<li>
<p>Change to the <code>service-telemetry</code> namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc project service-telemetry</code></pre>
</div>
</div>
</li>
<li>
<p>Use the oc command to edit the ServiceTelemetry object:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc edit stf default</code></pre>
</div>
</div>
</li>
<li>
<p>Add <code>highAvailability.enabled: true</code> to the <code>spec</code> section:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: infra.watch/v1beta1
kind: ServiceTelemetry
...
spec:
  ...
  highAvailability:
    enabled: true</code></pre>
</div>
</div>
</li>
<li>
<p>Save your changes and close the object.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dashboards_advanced-features">Dashboards</h3>
<div class="paragraph">
<p>Use third-party application Grafana to visualize system-level metrics gathered by collectd for each individual host node. For more information about configuring collectd, see <a href="#configuring-red-hat-openstack-platform-overcloud-for-stf_completing-the-stf-configuration">Configuring OpenStack overcloud for Service&#160;Telemetry&#160;Framework</a>.</p>
</div>
<div class="sect3">
<h4 id="setting-up-grafana-to-host-the-dashboard_advanced-features">Setting up Grafana to host the dashboard</h4>
<div class="paragraph">
<p>Grafana is not included in the default Service&#160;Telemetry&#160;Framework (STF) deployment so you must deploy the Grafana Operator from OperatorHub.io. Using the Service Telemetry Operator to deploy Grafana results in a Grafana instance and the  configuration of the default data sources for the local STF deployment.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Enable OperatorHub.io catalog source for the Grafana Operator. For more information, see <a href="#enabling-the-operatorhubio-community-catalog-source">Enabling the OperatorHub.io Community Catalog Source</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to OpenShift.</p>
</li>
<li>
<p>Change to the <code>service-telemetry</code> namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc project service-telemetry</code></pre>
</div>
</div>
</li>
<li>
<p>Deploy the Grafana operator:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc apply -f - &lt;&lt;EOF
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: grafana-operator
  namespace: service-telemetry
spec:
  channel: alpha
  installPlanApproval: Automatic
  name: grafana-operator
  source: operatorhubio-operators
  sourceNamespace: openshift-marketplace
EOF</code></pre>
</div>
</div>
</li>
<li>
<p>To verify that the operator launched successfully, run the <code>oc get csv</code> command. If the value of the PHASE column is <code>Succeeded</code>, the operator launched successfully:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">$ oc get csv</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">NAME                                DISPLAY                                         VERSION   REPLACES                            PHASE
grafana-operator.v3.2.0             Grafana Operator                                3.2.0                                         Succeeded
...</code></pre>
</div>
</div>
</li>
<li>
<p>To launch a Grafana instance, create or modify the <code>ServiceTelemetry</code> object. Set <code>graphing.enabled</code> to <code>true</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc edit stf default</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: infra.watch/v1beta1
kind: ServiceTelemetry
...
spec:
  ...
  graphing:
    enabled: true</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the Grafana instance deployed:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc get pod -l app=grafana</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME                                  READY   STATUS    RESTARTS   AGE
grafana-deployment-7fc7848b56-sbkhv   1/1     Running   0          1m</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="importing-dashboards_advanced-features">Importing dashboards</h4>
<div class="paragraph">
<p>The Grafana Operator can import and manage dashboards by creating <code>GrafanaDashboard</code> objects. You can view example dashboards at <a href="https://github.com/infrawatch/dashboards" class="bare">https://github.com/infrawatch/dashboards</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Import a dashboard:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">$ oc apply -f https://raw.githubusercontent.com/infrawatch/dashboards/master/deploy/rhos-dashboard.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>grafanadashboard.integreatly.org/rhos-dashboard created</pre>
</div>
</div>
</li>
<li>
<p>Verify that the resources installed correctly:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc get grafanadashboards</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME             AGE
rhos-dashboard   7d21h</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc get grafanadatasources</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME                    AGE
default-ds-prometheus   20h</pre>
</div>
</div>
</li>
<li>
<p>Expose the grafana service as a route:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">$ oc create route edge dashboards --service=grafana-service --insecure-policy="Redirect" --port=3000</code></pre>
</div>
</div>
</li>
<li>
<p>Retrieve the Grafana route address:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc get route dashboards</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">NAME         HOST/PORT                                                                    PATH   SERVICES          PORT   TERMINATION     WILDCARD
dashboards   dashboards-service-telemetry.apps.stfcloudops1.lab.upshift.rdu2.redhat.com          grafana-service   3000   edge/Redirect   None</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>HOST/PORT</code> value is the Grafana route address.</p>
</div>
</li>
<li>
<p>Navigate to <a href="https://&lt;GRAFANA-ROUTE-ADDRESS&gt" class="bare">https://&lt;GRAFANA-ROUTE-ADDRESS&gt</a>; in a web browser. Replace &lt;GRAFANA-ROUTE-ADDRESS&gt; with the <code>HOST/PORT</code> value that you retrieved in the previous step.</p>
</li>
<li>
<p>To view the dashboard, click <strong>Dashboards</strong> and <strong>Manage</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="viewing-and-editing-queries">Viewing and editing queries</h4>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to OpenShift. To view and edit queries, log in as the <code>admin</code> user.</p>
</li>
<li>
<p>Change to the <code>service-telemetry</code> namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc project service-telemetry</code></pre>
</div>
</div>
</li>
<li>
<p>To retrieve the default username and password, describe the Grafana object using the <code>oc describe</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc describe grafana default</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To set the admin username and password through the <code>ServiceTelemetry</code> object, use the <code>graphing.grafana.adminUser</code> and <code>graphing.grafana.adminPassword</code> parameters.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="the-grafana-infrastructure-dashboard_advanced-features">The Grafana infrastructure dashboard</h4>
<div class="paragraph">
<p>The infrastructure dashboard shows metrics for a single node at a time. Select a node from the upper left corner of the dashboard.</p>
</div>
<div class="sect4">
<h5 id="_top_panels">Top panels</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;"/>
<col style="width: 33.3333%;"/>
<col style="width: 33.3334%;"/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Title</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Unit</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current Global Alerts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current alerts fired by Prometheus</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recent Global Alerts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recently fired alerts in 5m time steps</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Status Panel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node status: up, down, unavailable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uptime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s/m/h/d/M/Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total operational time of node</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU Cores</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cores</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total number of cores</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total memory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disk Size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total storage size</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">processes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total number of processes listed by type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Load Average</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">processes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Load average represents the average number of running and uninterruptible processes residing in the kernel execution queue.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_networking_panels">Networking panels</h5>
<div class="paragraph">
<p>Panels that display the network interfaces of the node.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;"/>
<col style="width: 33.3333%;"/>
<col style="width: 33.3334%;"/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Panel</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Unit</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical Interfaces Ingress Errors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">errors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total errors with incoming data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical Interfaces Egress Errors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">errors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total errors with outgoing data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical Interfaces Ingress Error Rates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">errors/s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rate of incoming data errors</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical Interfaces egress Error Rates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">errors/s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rate of outgoing data errors</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical Interfaces Packets Ingress
pps
Incoming packets per second</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical Interfaces Packets Egress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pps</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outgoing packets per second</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical Interfaces Data Ingress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bytes/s</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incoming data rates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical Interfaces Data Egress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bytes/s</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outgoing data rates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical Interfaces Drop Rate Ingress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pps</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incoming packets drop rate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical Interfaces Drop Rate Egress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pps</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_panels">CPU panels</h5>
<div class="paragraph">
<p>Panels that display CPU usage of the node.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;"/>
<col style="width: 33.3333%;"/>
<col style="width: 33.3334%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Panel</strong></th>
<th class="tableblock halign-left valign-top"><strong>Unit</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current CPU Usage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">percent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instantaneous usage at the time of the last query.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aggregate CPU Usage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">percent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Average non-idle CPU activity of all cores on a node.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aggr. CPU Usage by Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">percent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shows time spent for each type of thread averaged across all cores.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_memory_panels">Memory panels</h5>
<div class="paragraph">
<p>Panels that display memory usage on the node.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;"/>
<col style="width: 33.3333%;"/>
<col style="width: 33.3334%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Panel</strong></th>
<th class="tableblock halign-left valign-top"><strong>Unit</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memory Used</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">percent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amount of memory being used at time of last query.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Huge Pages Used</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hugepages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of hugepages being used.</p>
<p class="tableblock">Memory</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_diskfile_system">Disk/file system</h5>
<div class="paragraph">
<p>Panels that display space used on disk.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;"/>
<col style="width: 25%;"/>
<col style="width: 25%;"/>
<col style="width: 25%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Panel</strong></th>
<th class="tableblock halign-left valign-top"><strong>Unit</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
<th class="tableblock halign-left valign-top"><strong>Notes</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disk Space Usage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">percent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total disk use at time of last query.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inode Usage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">percent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total inode use at time of last query.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aggregate Disk Space Usage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total disk space used and reserved.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Because this query relies on the <code>df</code> plugin, temporary file systems that do not necessarily use disk space are included in the results. The query tries to filter out most of these, but it might not be exhaustive.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disk Traffic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bytes/s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shows rates for both reading and writing.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disk Load</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">percent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Approximate percentage of total disk bandwidth being used.
The weighted I/O time series includes the backlog that might be accumulating. For more information, see the collectd <a href="https://collectd.org/wiki/index.php/Plugin:Disk">disk plugin docs</a>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operations/s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ops/s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operations done per second</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Average I/O Operation Time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Average time each I/O operation took to complete. This average is not accurate, see the collectd <a href="https://collectd.org/wiki/index.php/Plugin:Disk">disk plugin docs</a>.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-multiple-clouds_advanced-features">Multiple cloud configuration</h3>
<div class="paragraph">
<p>You can configure multiple OpenStack clouds to target a single instance of Service&#160;Telemetry&#160;Framework (STF):</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Plan the AMQP address prefixes that you want to use for each cloud. For more information, see <a href="#planning-amqp-address-prefixes_advanced-features">Planning AMQP address prefixes</a>.</p>
</li>
<li>
<p>Deploy metrics and events consumer Smart Gateways for each cloud to listen on the corresponding address prefixes. For more information, see <a href="#deploying-smart-gateways_advanced-features">Deploying Smart Gateways</a>.</p>
</li>
<li>
<p>Configure each cloud to send its metrics and events to STF on the correct address. For more information, see <a href="#creating-openstack-environment-file_advanced-features">Creating the OpenStack environment file</a>.</p>
</li>
</ol>
</div>
<div id="osp-stf-multiple-clouds" class="imageblock">
<div class="content">
<img src="images/OpenStack_STF_Overview_37_0919_topology.png" alt="An exmaple of two OpenStack clouds connecting to STF"/>
</div>
<div class="title">Figure 3. Two OpenStack clouds connect to STF</div>
</div>
<div class="sect3">
<h4 id="planning-amqp-address-prefixes_advanced-features">Planning AMQP address prefixes</h4>
<div class="paragraph">
<p>By default, OpenStack nodes get data through two data collectors; collectd and Ceilometer. These components send telemetry data or notifications to the respective AMQP addresses, for example, <code>collectd/telemetry</code>, where STF Smart Gateways listen on those addresses for monitoring data.</p>
</div>
<div class="paragraph">
<p>To support multiple clouds and to identify which cloud generated the monitoring data, configure each cloud to send data to a unique address. Prefix a cloud identifier to the second part of the address. The following list shows some example addresses and identifiers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>collectd/cloud1-telemetry</code></p>
</li>
<li>
<p><code>collectd/cloud1-notify</code></p>
</li>
<li>
<p><code>anycast/ceilometer/cloud1-metering.sample</code></p>
</li>
<li>
<p><code>anycast/ceilometer/cloud1-event.sample</code></p>
</li>
<li>
<p><code>collectd/cloud2-telemetry</code></p>
</li>
<li>
<p><code>collectd/cloud2-notify</code></p>
</li>
<li>
<p><code>anycast/ceilometer/cloud2-metering.sample</code></p>
</li>
<li>
<p><code>anycast/ceilometer/cloud2-event.sample</code></p>
</li>
<li>
<p><code>collectd/us-east-1-telemetry</code></p>
</li>
<li>
<p><code>collectd/us-west-3-telemetry</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="deploying-smart-gateways_advanced-features">Deploying Smart Gateways</h4>
<div class="paragraph">
<p>You must deploy a Smart Gateway for each of the data collection types for each cloud; one for collectd metrics, one for collectd events, one for Ceilometer metrics, and one for Ceilometer events. Configure each of the Smart Gateways to listen on the AMQP address that you define for the corresponding cloud. Smart Gateways are defined via the <code>clouds</code> parameter in the <code>ServiceTelemetry</code> manifest.</p>
</div>
<div class="paragraph">
<p>When you deploy STF for the first time, Smart Gateway manifests are created that define the initial Smart Gateways for a single cloud. When deploying Smart Gateways for multiple cloud support, you deploy multiple Smart Gateways for each of the data collection types that handle the metrics and the events data for each cloud. The initial Smart Gateways are defined under <code>cloud1</code> with the following subscription addresses:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;"/>
<col style="width: 33.3333%;"/>
<col style="width: 33.3334%;"/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>collector</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>default subscription address</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">collectd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">collectd/telemetry</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">collectd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">events</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">collectd/notify</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ceilometer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">anycast/ceilometer/metering.sample</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ceilometer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">events</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">anycast/ceilometer/event.sample</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>You have determined your naming scheme and have created your list of clouds objects. For more information about determining your naming scheme, see <a href="#planning-amqp-address-prefixes_advanced-features">Planning AMQP address prefixes</a>. For more information about creating the content for the <code>clouds</code> parameter, see <a href="#clouds_installing-the-core-components-of-stf">clouds</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to OpenShift.</p>
</li>
<li>
<p>Change to the <code>service-telemetry</code> namespace:</p>
<div class="listingblock">
<div class="content">
<pre>$ oc project service-telemetry</pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>default</code> ServiceTelemetry object and add a <code>clouds</code> parameter with your configuration:</p>
<div class="listingblock">
<div class="content">
<pre>$ oc edit stf default</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>apiVersion: infra.watch/v1beta1
kind: ServiceTelemetry
metadata:
  ...
spec:
  ...
  clouds:
  - name: cloud1
    events:
      collectors:
      - collectorType: collectd
        subscriptionAddress: collectd/cloud1-notify
      - collectorType: ceilometer
        subscriptionAddress: anycast/ceilometer/cloud1-event.sample
    metrics:
      collectors:
      - collectorType: collectd
        subscriptionAddress: collectd/cloud1-telemetry
      - collectorType: ceilometer
        subscriptionAddress: anycast/ceilometer/cloud1-metering.sample
  - name: cloud2
    events:
      ...</pre>
</div>
</div>
</li>
<li>
<p>Save the ServiceTelemetry object.</p>
</li>
<li>
<p>Verify that each Smart Gateway is running. This can take several minutes depending on the number of Smart Gateways:</p>
<div class="listingblock">
<div class="content">
<pre>$ oc get po -l app=smart-gateway</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME                                                      READY   STATUS    RESTARTS   AGE
default-cloud1-ceil-event-smartgateway-6cfb65478c-g5q82   1/1     Running   0          13h
default-cloud1-ceil-meter-smartgateway-58f885c76d-xmxwn   1/1     Running   0          13h
default-cloud1-coll-event-smartgateway-58fbbd4485-rl9bd   1/1     Running   0          13h
default-cloud1-coll-meter-smartgateway-7c6fc495c4-jn728   2/2     Running   0          13h</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="deleting-the-default-smart-gateways_advanced-features">Deleting the default Smart Gateways</h4>
<div class="paragraph">
<p>After you configure STF for multiple clouds, you can delete the default Smart Gateways if they are no longer in use. The Service Telemetry Operator can remove <code>SmartGateway</code> objects that have been created but are no longer listed in the ServiceTelemetry <code>clouds</code> list of objects. You can enable the removal of SmartGateway objects that are not defined by the <code>clouds</code> parameter by setting <code>cloudsRemoveOnMissing: true</code> in the <code>ServiceTelemetry</code> manifest.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you do not want any Smart Gateways deployed, define an empty clouds object using the <code>clouds: {}</code> parameter.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The <code>cloudsRemoveOnMissing</code> parameter is disabled by default. If you enable the <code>cloudsRemoveOnMissing</code> parameter, you remove any manually created <code>SmartGateway</code> objects in the current namespace without any possibility to restore.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Define your <code>clouds</code> parameter with the list of cloud objects to be managed by the Service Telemetry Operator. For more information, see <a href="#clouds_installing-the-core-components-of-stf">clouds</a>.</p>
</li>
<li>
<p>Edit the ServiceTelemetry object and add the <code>cloudsRemoveOnMissing</code> parameter:</p>
<div class="listingblock">
<div class="content">
<pre>apiVersion: infra.watch/v1beta1
kind: ServiceTelemetry
metadata:
  ...
spec:
  ...
  cloudsRemoveOnMissing: true
  clouds:
    ...</pre>
</div>
</div>
</li>
<li>
<p>Save the modifications.</p>
</li>
<li>
<p>Verify that the Operator deleted the Smart Gateways. This can take several minutes while the Operators reconcile the changes:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc get smartgateways</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="creating-openstack-environment-file_advanced-features">Creating the OpenStack environment file</h4>
<div class="paragraph">
<p>To label traffic according to the cloud of origin, you must create a configuration with cloud-specific instance names. Create an <code>stf-connectors.yaml</code> file and adjust the values of <code>CeilometerQdrEventsConfig</code>, <code>CeilometerQdrMetricsConfig</code> and <code>CollectdAmqpInstances</code> to match the AMQP address prefix scheme.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you have enabled container health and API status monitoring, you must also modify the <code>CollectdSensubilityResultsChannel</code> parameter. For more information, see <a href="#planning-amqp-address-prefixes_advanced-features">Planning AMQP address prefixes</a> and <a href="#monitoring-container-health-and-api-status_advanced-features">[monitoring-container-health-and-api-status_advanced-features]</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Remove
<code>enable-stf.yaml</code> and
<code>ceilometer-write-qdr.yaml</code> environment file references from your overcloud deployment. This configuration is redundant and results in duplicate information being sent from each cloud node.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the <code>stf-connectors.yaml</code> file and modify it to match the AMQP address that you want for this cloud deployment:</p>
<div class="listingblock">
<div class="title">stf-connectors.yaml</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">resource_registry:
    OS::TripleO::Services::Collectd: /usr/share/openstack-tripleo-heat-templates/deployment/metrics/collectd-container-puppet.yaml
    OS::TripleO::Services::MetricsQdr: /usr/share/openstack-tripleo-heat-templates/deployment/metrics/qdr-container-puppet.yaml
    OS::TripleO::Services::CeilometerAgentCentral: /usr/share/openstack-tripleo-heat-templates/deployment/ceilometer/ceilometer-agent-central-container-puppet.yaml
    OS::TripleO::Services::CeilometerAgentNotification: /usr/share/openstack-tripleo-heat-templates/deployment/ceilometer/ceilometer-agent-notification-container-puppet.yaml
    OS::TripleO::Services::CeilometerAgentIpmi: /usr/share/openstack-tripleo-heat-templates/deployment/ceilometer/ceilometer-agent-ipmi-container-puppet.yaml
    OS::TripleO::Services::ComputeCeilometerAgent: /usr/share/openstack-tripleo-heat-templates/deployment/ceilometer/ceilometer-agent-compute-container-puppet.yaml
    OS::TripleO::Services::Redis: /usr/share/openstack-tripleo-heat-templates/deployment/database/redis-pacemaker-puppet.yaml

parameter_defaults:
    EnableSTF: true

    EventPipelinePublishers: []
    MetricPipelinePublishers: []
    CeilometerEnablePanko: false
    CeilometerQdrPublishEvents: true
    CeilometerQdrEventsConfig:
        driver: amqp
        topic: cloud1-event   <i class="conum" data-value="1"></i><b>(1)</b>
    CeilometerQdrMetricsConfig:
        driver: amqp
        topic: cloud1-metering   <i class="conum" data-value="2"></i><b>(2)</b>


    CollectdConnectionType: amqp1
    CollectdAmqpInterval: 5
    CollectdDefaultPollingInterval: 5

    CollectdAmqpInstances:
        cloud1-notify:        <i class="conum" data-value="3"></i><b>(3)</b>
            notify: true
            format: JSON
            presettle: false
        cloud1-telemetry:     <i class="conum" data-value="4"></i><b>(4)</b>
            format: JSON
            presettle: true
    CollectdSensubilityTransport: amqp1
    CollectdSensubilityResultsChannel: collectd/cloud1-notify <i class="conum" data-value="5"></i><b>(5)</b>

    MetricsQdrAddresses:
        - prefix: collectd
          distribution: multicast
        - prefix: anycast/ceilometer
          distribution: multicast

    MetricsQdrSSLProfiles:
        - name: sslProfile

    MetricsQdrConnectors:
        - host: stf-default-interconnect-5671-service-telemetry.apps.infra.watch   <i class="conum" data-value="6"></i><b>(6)</b>
          port: 443
          role: edge
          verifyHostname: false
          sslProfile: sslProfile</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Define the topic for Ceilometer events. This value is the address format of <code>anycast/ceilometer/cloud1-event.sample</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define the topic for Ceilometer metrics. This value is the address format of <code>anycast/ceilometer/cloud1-metering.sample</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define the topic for collectd events. This value is the format of <code>collectd/cloud1-notify</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Define the topic for collectd metrics. This value is the format of <code>collectd/cloud1-telemetry</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Define the topic for collectd-sensubility events. This should be the exact string format of <code>collectd/cloud1-notify</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Adjust the <code>MetricsQdrConnectors</code> host to the address of the STF route.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Ensure that the naming convention in the <code>stf-connectors.yaml</code> file aligns with the <code>spec.amqpUrl</code> field in the Smart Gateway configuration. For example, configure the <code>CeilometerQdrEventsConfig.topic</code> field to a value of <code>cloud1-event</code>.</p>
</li>
<li>
<p>Save the file in a directory for custom environment files, for example <code>/home/stack/custom_templates/</code>.</p>
</li>
<li>
<p>Source the authentication file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[stack@undercloud-0 ~]$ source stackrc

(undercloud) [stack@undercloud-0 ~]$</code></pre>
</div>
</div>
</li>
<li>
<p>Include the <code>stf-connectors.yaml</code> file in the <code>overcloud deployment</code> command, along with any other environment files relevant to your environment:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">(undercloud) [stack@undercloud-0 ~]$ openstack overcloud deploy \
--templates /usr/share/openstack-tripleo-heat-templates \
...
-e /home/stack/custom_templates/stf-connectors.yaml \
...</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>For information about validating the deployment, see <a href="#validating-clientside-installation_completing-the-stf-configuration">Validating client-side installation</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="querying-metrics-data-from-multiple-clouds_advanced-features">Querying metrics data from multiple clouds</h4>
<div class="paragraph">
<p>Data stored in Prometheus has a <em>service</em> label attached according to the Smart Gateway it was scraped from. You can use this label to query data from a specific cloud.</p>
</div>
<div class="paragraph">
<p>To query data from a specific cloud, use a Prometheus <code>promql</code> query that matches the associated <em>service</em> label; for example: <code>collectd_uptime{service="default-cloud1-coll-meter-smartgateway"}</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ephemeral-storage_advanced-features">Ephemeral storage</h3>
<div class="paragraph">
<p>Use ephemeral storage to run Service&#160;Telemetry&#160;Framework (STF) without persistently storing data in your OpenShift (OKD) cluster.  Ephemeral storage is not recommended in a production environment due to the volatility of the data in the platform when operating correctly and as designed. For example, restarting a pod or rescheduling the workload to another node results in the loss of any local data written since the pod started.</p>
</div>
<div class="sect3">
<h4 id="configuring-ephemeral-storage_advanced-features">Configuring ephemeral storage</h4>
<div class="paragraph">
<p>To configure STF components for ephemeral storage, add <code>...storage.strategy: ephemeral</code> to the corresponding parameter. For example, to enable ephemeral storage for the Prometheus backend, set <code>backends.metrics.prometheus.storage.strategy: ephemeral</code>. Components that support configuration of ephemeral storage include <code>alerting.alertmanager</code>, <code>backends.metrics.prometheus</code>, and <code>backends.events.elasticsearch</code>. You can add ephemeral storage configuration at installation time or, if you already deployed STF, complete the following steps:</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to OpenShift.</p>
</li>
<li>
<p>Change to the <code>service-telemetry</code> namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc project service-telemetry</code></pre>
</div>
</div>
</li>
<li>
<p>Edit the ServiceTelemetry object:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc edit stf default</code></pre>
</div>
</div>
</li>
<li>
<p>Add the <code>...storage.strategy: ephemeral</code> parameter to the <code>spec</code> section of the relevant component:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: infra.watch/v1beta1
kind: ServiceTelemetry
metadata:
  name: stf-default
  namespace: service-telemetry
spec:
  alerting:
    enabled: true
    alertmanager:
      storage:
        strategy: ephemeral
  backends:
    metrics:
      prometheus:
        enabled: true
        storage:
          strategy: ephemeral
    events:
      elasticsearch:
        enabled: true
        storage:
          strategy: ephemeral</code></pre>
</div>
</div>
</li>
<li>
<p>Save your changes and close the object.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="monitoring-resource-usage-of-openstack-services_advanced-features">Monitoring the resource usage of OpenStack services</h3>
<div class="paragraph">
<p>Monitor the resource usage of the OpenStack services, such as the APIs and other infrastructure processes, to identify bottlenecks in the overcloud by showing services running out of compute power. Enable the <code>collectd-libpod-stats</code> plug-in to gather CPU and memory usage metrics for every container running in the overcloud.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have created the <code>stf-connectors.yaml</code> file. For more information, see <a href="#configuring-red-hat-openstack-platform-overcloud-for-stf_completing-the-stf-configuration">Configuring OpenStack overcloud for Service&#160;Telemetry&#160;Framework</a>.</p>
</li>
<li>
<p>You are using the most current version of OpenStack: Train.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open the <code>stf-connectors.yaml</code> file.</p>
</li>
<li>
<p>Add the following configuration to <code>parameter_defaults</code>:</p>
<div class="listingblock">
<div class="content">
<pre>  CollectdEnableLibpodstats: true</pre>
</div>
</div>
</li>
<li>
<p>Continue with the overcloud deployment procedure.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="exposing-routes_advanced-features">Creating a route in OpenShift</h3>
<div class="paragraph">
<p>In OpenShift, you can expose applications to the external network via a route. For more information, see <a href="https://docs.openshift.com/container-platform/4.5/networking/configuring_ingress_cluster_traffic/overview-traffic.html">Configuring ingress cluster traffic</a>.</p>
</div>
<div class="paragraph">
<p>Routes are not exposed by default in Service&#160;Telemetry&#160;Framework to limit the attack surface of STF deployments. To access some services deployed in STF, you must expose the services in OKD for access.</p>
</div>
<div class="paragraph">
<p>A common service to expose in STF is Prometheus, as shown in the following example:</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to OpenShift.</p>
</li>
<li>
<p>Change to the <code>service-telemetry</code> namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc project service-telemetry</code></pre>
</div>
</div>
</li>
<li>
<p>List the available services in the <code>service-telemetry</code> project:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc get services</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">NAME                                     TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                                         AGE
alertmanager-operated                    ClusterIP   None             &lt;none&gt;        9093/TCP,9094/TCP,9094/UDP                      93m
default-cloud1-ceil-meter-smartgateway   ClusterIP   172.30.114.195   &lt;none&gt;        8081/TCP                                        93m
default-cloud1-coll-meter-smartgateway   ClusterIP   172.30.133.180   &lt;none&gt;        8081/TCP                                        93m
default-interconnect                     ClusterIP   172.30.3.241     &lt;none&gt;        5672/TCP,8672/TCP,55671/TCP,5671/TCP,5673/TCP   93m
ibm-auditlogging-operator-metrics        ClusterIP   172.30.216.249   &lt;none&gt;        8383/TCP,8686/TCP                               11h
prometheus-operated                      ClusterIP   None             &lt;none&gt;        9090/TCP                                        93m
service-telemetry-operator-metrics       ClusterIP   172.30.11.66     &lt;none&gt;        8383/TCP,8686/TCP                               11h
smart-gateway-operator-metrics           ClusterIP   172.30.145.199   &lt;none&gt;        8383/TCP,8686/TCP                               11h</code></pre>
</div>
</div>
</li>
<li>
<p>Take note of the port and service name to expose as a route, for example, service <code>prometheus-operated</code> and port <code>9090</code>.</p>
</li>
<li>
<p>Expose the <code>prometheus-operated</code> service as an edge route and redirect insecure traffic to the secure endpoint of port <code>9090</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-bash" data-lang="bash">$ oc create route edge metrics-store --service=prometheus-operated --insecure-policy="Redirect" --port=9090</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>route.route.openshift.io/metrics-store created</pre>
</div>
</div>
</li>
<li>
<p>To verify and find the exposed external DNS for the route, use the <code>oc get route</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc get route metrics-store -ogo-template='{{.spec.host}}'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>metrics-store-service-telemetry.apps.infra.watch</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>prometheus-operated</code> service is now available at the exposed DNS address, for example, <a href="https://metrics-store-service-telemetry.apps.infra.watch" class="bare">https://metrics-store-service-telemetry.apps.infra.watch</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The address of the route must be resolvable and configuration is environment specific.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Additional resources</div>
<ol class="arabic">
<li>
<p>For more information about OpenShift networking, see <a href="https://docs.openshift.com/container-platform/4.5/networking/understanding-networking.html">Understanding networking</a></p>
</li>
<li>
<p>For more information about route configuration, see <a href="https://docs.openshift.com/container-platform/4.5/networking/routes/route-configuration.html">Route configuration</a></p>
</li>
<li>
<p>For more information about ingress cluster traffic, see <a href="https://docs.openshift.com/container-platform/4.5/networking/configuring_ingress_cluster_traffic/overview-traffic.html">Configuring ingress cluster traffic overview</a></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appe-stf-collectd-plugins">Appendix A: collectd plug-ins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section contains a complete list of collectd plug-ins and configurations for OpenStack Train.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">collectd-aggregation</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::aggregation::aggregators</p>
</li>
<li>
<p>collectd::plugin::aggregation::interval</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>collectd-amqp1</strong></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">collectd-apache</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::apache::instances (ex.: {<em>localhost</em> &#8658; {<em>url</em> &#8658; <em><a href="http://localhost/mod_status?auto" class="bare">http://localhost/mod_status?auto</a></em>}})</p>
</li>
<li>
<p>collectd::plugin::apache::interval</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>collectd-apcups</strong></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">collectd-battery</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::battery::values_percentage</p>
</li>
<li>
<p>collectd::plugin::battery::report_degraded</p>
</li>
<li>
<p>collectd::plugin::battery::query_state_fs</p>
</li>
<li>
<p>collectd::plugin::battery::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-ceph</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::ceph::daemons</p>
</li>
<li>
<p>collectd::plugin::ceph::longrunavglatency</p>
</li>
<li>
<p>collectd::plugin::ceph::convertspecialmetrictypes</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-cgroups</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::cgroups::ignore_selected</p>
</li>
<li>
<p>collectd::plugin::cgroups::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-conntrack</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-contextswitch</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::contextswitch::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-cpu</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::cpu::reportbystate</p>
</li>
<li>
<p>collectd::plugin::cpu::reportbycpu</p>
</li>
<li>
<p>collectd::plugin::cpu::valuespercentage</p>
</li>
<li>
<p>collectd::plugin::cpu::reportnumcpu</p>
</li>
<li>
<p>collectd::plugin::cpu::reportgueststate</p>
</li>
<li>
<p>collectd::plugin::cpu::subtractgueststate</p>
</li>
<li>
<p>collectd::plugin::cpu::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-cpufreq</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>collectd-cpusleep</strong></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">collectd-csv</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::csv::datadir</p>
</li>
<li>
<p>collectd::plugin::csv::storerates</p>
</li>
<li>
<p>collectd::plugin::csv::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-df</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::df::devices</p>
</li>
<li>
<p>collectd::plugin::df::fstypes</p>
</li>
<li>
<p>collectd::plugin::df::ignoreselected</p>
</li>
<li>
<p>collectd::plugin::df::mountpoints</p>
</li>
<li>
<p>collectd::plugin::df::reportbydevice</p>
</li>
<li>
<p>collectd::plugin::df::reportinodes</p>
</li>
<li>
<p>collectd::plugin::df::reportreserved</p>
</li>
<li>
<p>collectd::plugin::df::valuesabsolute</p>
</li>
<li>
<p>collectd::plugin::df::valuespercentage</p>
</li>
<li>
<p>collectd::plugin::df::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-disk</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::disk::disks</p>
</li>
<li>
<p>collectd::plugin::disk::ignoreselected</p>
</li>
<li>
<p>collectd::plugin::disk::udevnameattr</p>
</li>
<li>
<p>collectd::plugin::disk::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-entropy</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::entropy::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-ethstat</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::ethstat::interfaces</p>
</li>
<li>
<p>collectd::plugin::ethstat::maps</p>
</li>
<li>
<p>collectd::plugin::ethstat::mappedonly</p>
</li>
<li>
<p>collectd::plugin::ethstat::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-exec</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::exec::commands</p>
</li>
<li>
<p>collectd::plugin::exec::commands_defaults</p>
</li>
<li>
<p>collectd::plugin::exec::globals</p>
</li>
<li>
<p>collectd::plugin::exec::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-fhcount</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::fhcount::valuesabsolute</p>
</li>
<li>
<p>collectd::plugin::fhcount::valuespercentage</p>
</li>
<li>
<p>collectd::plugin::fhcount::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-filecount</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::filecount::directories</p>
</li>
<li>
<p>collectd::plugin::filecount::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-fscache</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-hddtemp</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::hddtemp::host</p>
</li>
<li>
<p>collectd::plugin::hddtemp::port</p>
</li>
<li>
<p>collectd::plugin::hddtemp::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-hugepages</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::hugepages::report_per_node_hp</p>
</li>
<li>
<p>collectd::plugin::hugepages::report_root_hp</p>
</li>
<li>
<p>collectd::plugin::hugepages::values_pages</p>
</li>
<li>
<p>collectd::plugin::hugepages::values_bytes</p>
</li>
<li>
<p>collectd::plugin::hugepages::values_percentage</p>
</li>
<li>
<p>collectd::plugin::hugepages::interval</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>collectd-intel_rdt</strong></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">collectd-interface</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::interface::interfaces</p>
</li>
<li>
<p>collectd::plugin::interface::ignoreselected</p>
</li>
<li>
<p>collectd::plugin::interface::reportinactive</p>
</li>
<li>
<p>Collectd::plugin::interface::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-ipc</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-ipmi</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::ipmi::ignore_selected</p>
</li>
<li>
<p>collectd::plugin::ipmi::notify_sensor_add</p>
</li>
<li>
<p>collectd::plugin::ipmi::notify_sensor_remove</p>
</li>
<li>
<p>collectd::plugin::ipmi::notify_sensor_not_present</p>
</li>
<li>
<p>collectd::plugin::ipmi::sensors</p>
</li>
<li>
<p>collectd::plugin::ipmi::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-irq</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::irq::irqs</p>
</li>
<li>
<p>collectd::plugin::irq::ignoreselected</p>
</li>
<li>
<p>collectd::plugin::irq::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-load</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::load::report_relative</p>
</li>
<li>
<p>collectd::plugin::load::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-logfile</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::logfile::log_level</p>
</li>
<li>
<p>collectd::plugin::logfile::log_file</p>
</li>
<li>
<p>collectd::plugin::logfile::log_timestamp</p>
</li>
<li>
<p>collectd::plugin::logfile::print_severity</p>
</li>
<li>
<p>collectd::plugin::logfile::interval</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>collectd-madwifi</strong></p>
</div>
<div class="paragraph">
<p><strong>collectd-mbmon</strong></p>
</div>
<div class="paragraph">
<p><strong>collectd-md</strong></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">collectd-memcached</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::memcached::instances</p>
</li>
<li>
<p>collectd::plugin::memcached::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-memory</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::memory::valuesabsolute</p>
</li>
<li>
<p>collectd::plugin::memory::valuespercentage</p>
</li>
<li>
<p>collectd::plugin::memory::interval
collectd-multimeter</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>collectd-multimeter</strong></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">collectd-mysql</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::mysql::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-netlink</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::netlink::interfaces</p>
</li>
<li>
<p>collectd::plugin::netlink::verboseinterfaces</p>
</li>
<li>
<p>collectd::plugin::netlink::qdiscs</p>
</li>
<li>
<p>collectd::plugin::netlink::classes</p>
</li>
<li>
<p>collectd::plugin::netlink::filters</p>
</li>
<li>
<p>collectd::plugin::netlink::ignoreselected</p>
</li>
<li>
<p>collectd::plugin::netlink::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-network</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::network::timetolive</p>
</li>
<li>
<p>collectd::plugin::network::maxpacketsize</p>
</li>
<li>
<p>collectd::plugin::network::forward</p>
</li>
<li>
<p>collectd::plugin::network::reportstats</p>
</li>
<li>
<p>collectd::plugin::network::listeners</p>
</li>
<li>
<p>collectd::plugin::network::servers</p>
</li>
<li>
<p>collectd::plugin::network::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-nfs</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::nfs::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-ntpd</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::ntpd::host</p>
</li>
<li>
<p>collectd::plugin::ntpd::port</p>
</li>
<li>
<p>collectd::plugin::ntpd::reverselookups</p>
</li>
<li>
<p>collectd::plugin::ntpd::includeunitid</p>
</li>
<li>
<p>collectd::plugin::ntpd::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-numa</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>collectd-olsrd</strong></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">collectd-openvpn</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::openvpn::statusfile</p>
</li>
<li>
<p>collectd::plugin::openvpn::improvednamingschema</p>
</li>
<li>
<p>collectd::plugin::openvpn::collectcompression</p>
</li>
<li>
<p>collectd::plugin::openvpn::collectindividualusers</p>
</li>
<li>
<p>collectd::plugin::openvpn::collectusercount</p>
</li>
<li>
<p>collectd::plugin::openvpn::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-ovs_events</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::ovs_events::address</p>
</li>
<li>
<p>collectd::plugin::ovs_events::dispatch</p>
</li>
<li>
<p>collectd::plugin::ovs_events::interfaces</p>
</li>
<li>
<p>collectd::plugin::ovs_events::send_notification</p>
</li>
<li>
<p>collectd::plugin::ovs_events::$port</p>
</li>
<li>
<p>collectd::plugin::ovs_events::socket</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-ovs_stats</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::ovs_stats::address</p>
</li>
<li>
<p>collectd::plugin::ovs_stats::bridges</p>
</li>
<li>
<p>collectd::plugin::ovs_stats::port</p>
</li>
<li>
<p>collectd::plugin::ovs_stats::socket</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-ping</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::ping::hosts</p>
</li>
<li>
<p>collectd::plugin::ping::timeout</p>
</li>
<li>
<p>collectd::plugin::ping::ttl</p>
</li>
<li>
<p>collectd::plugin::ping::source_address</p>
</li>
<li>
<p>collectd::plugin::ping::device</p>
</li>
<li>
<p>collectd::plugin::ping::max_missed</p>
</li>
<li>
<p>collectd::plugin::ping::size</p>
</li>
<li>
<p>collectd::plugin::ping::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-powerdns</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::powerdns::interval</p>
</li>
<li>
<p>collectd::plugin::powerdns::servers</p>
</li>
<li>
<p>collectd::plugin::powerdns::recursors</p>
</li>
<li>
<p>collectd::plugin::powerdns::local_socket</p>
</li>
<li>
<p>collectd::plugin::powerdns::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-processes</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::processes::processes</p>
</li>
<li>
<p>collectd::plugin::processes::process_matches</p>
</li>
<li>
<p>collectd::plugin::processes::collect_context_switch</p>
</li>
<li>
<p>collectd::plugin::processes::collect_file_descriptor</p>
</li>
<li>
<p>collectd::plugin::processes::collect_memory_maps</p>
</li>
<li>
<p>collectd::plugin::powerdns::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-protocols</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::protocols::ignoreselected</p>
</li>
<li>
<p>collectd::plugin::protocols::values</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>collectd-python</strong></p>
</div>
<div class="paragraph">
<p><strong>collectd-serial</strong></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">collectd-smart</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::smart::disks</p>
</li>
<li>
<p>collectd::plugin::smart::ignoreselected</p>
</li>
<li>
<p>collectd::plugin::smart::interval</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>collectd-snmp_agent</strong></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">collectd-statsd</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::statsd::host</p>
</li>
<li>
<p>collectd::plugin::statsd::port</p>
</li>
<li>
<p>collectd::plugin::statsd::deletecounters</p>
</li>
<li>
<p>collectd::plugin::statsd::deletetimers</p>
</li>
<li>
<p>collectd::plugin::statsd::deletegauges</p>
</li>
<li>
<p>collectd::plugin::statsd::deletesets</p>
</li>
<li>
<p>collectd::plugin::statsd::countersum</p>
</li>
<li>
<p>collectd::plugin::statsd::timerpercentile</p>
</li>
<li>
<p>collectd::plugin::statsd::timerlower</p>
</li>
<li>
<p>collectd::plugin::statsd::timerupper</p>
</li>
<li>
<p>collectd::plugin::statsd::timersum</p>
</li>
<li>
<p>collectd::plugin::statsd::timercount</p>
</li>
<li>
<p>collectd::plugin::statsd::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-swap</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::swap::reportbydevice</p>
</li>
<li>
<p>collectd::plugin::swap::reportbytes</p>
</li>
<li>
<p>collectd::plugin::swap::valuesabsolute</p>
</li>
<li>
<p>collectd::plugin::swap::valuespercentage</p>
</li>
<li>
<p>collectd::plugin::swap::reportio</p>
</li>
<li>
<p>collectd::plugin::swap::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-syslog</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::syslog::log_level</p>
</li>
<li>
<p>collectd::plugin::syslog::notify_level</p>
</li>
<li>
<p>collectd::plugin::syslog::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-table</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::table::tables</p>
</li>
<li>
<p>collectd::plugin::table::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-tail</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::tail::files</p>
</li>
<li>
<p>collectd::plugin::tail::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-tail_csv</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::tail_csv::metrics</p>
</li>
<li>
<p>collectd::plugin::tail_csv::files</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-tcpconns</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::tcpconns::localports</p>
</li>
<li>
<p>collectd::plugin::tcpconns::remoteports</p>
</li>
<li>
<p>collectd::plugin::tcpconns::listening</p>
</li>
<li>
<p>collectd::plugin::tcpconns::allportssummary</p>
</li>
<li>
<p>collectd::plugin::tcpconns::interval</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>collectd-ted</strong></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">collectd-thermal</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::thermal::devices</p>
</li>
<li>
<p>collectd::plugin::thermal::ignoreselected</p>
</li>
<li>
<p>collectd::plugin::thermal::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-threshold</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::threshold::types</p>
</li>
<li>
<p>collectd::plugin::threshold::plugins</p>
</li>
<li>
<p>collectd::plugin::threshold::hosts</p>
</li>
<li>
<p>collectd::plugin::threshold::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-turbostat</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::turbostat::core_c_states</p>
</li>
<li>
<p>collectd::plugin::turbostat::package_c_states</p>
</li>
<li>
<p>collectd::plugin::turbostat::system_management_interrupt</p>
</li>
<li>
<p>collectd::plugin::turbostat::digital_temperature_sensor</p>
</li>
<li>
<p>collectd::plugin::turbostat::tcc_activation_temp</p>
</li>
<li>
<p>collectd::plugin::turbostat::running_average_power_limit</p>
</li>
<li>
<p>collectd::plugin::turbostat::logical_core_names</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>collectd-unixsock</strong></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">collectd-uptime</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::uptime::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-users</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::users::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-uuid</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::uuid::uuid_file</p>
</li>
<li>
<p>collectd::plugin::uuid::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-virt</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::virt::connection</p>
</li>
<li>
<p>collectd::plugin::virt::refresh_interval</p>
</li>
<li>
<p>collectd::plugin::virt::domain</p>
</li>
<li>
<p>collectd::plugin::virt::block_device</p>
</li>
<li>
<p>collectd::plugin::virt::interface_device</p>
</li>
<li>
<p>collectd::plugin::virt::ignore_selected</p>
</li>
<li>
<p>collectd::plugin::virt::hostname_format</p>
</li>
<li>
<p>collectd::plugin::virt::interface_format</p>
</li>
<li>
<p>collectd::plugin::virt::extra_stats</p>
</li>
<li>
<p>collectd::plugin::virt::interval</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-vmem</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::vmem::verbose</p>
</li>
<li>
<p>collectd::plugin::vmem::interval</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>collectd-vserver</strong></p>
</div>
<div class="paragraph">
<p><strong>collectd-wireless</strong></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">collectd-write_graphite</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::write_graphite::carbons</p>
</li>
<li>
<p>collectd::plugin::write_graphite::carbon_defaults</p>
</li>
<li>
<p>collectd::plugin::write_graphite::globals</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-write_kafka</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::write_kafka::kafka_host</p>
</li>
<li>
<p>collectd::plugin::write_kafka::kafka_port</p>
</li>
<li>
<p>collectd::plugin::write_kafka::kafka_hosts</p>
</li>
<li>
<p>collectd::plugin::write_kafka::topics</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-write_log</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>collectd::plugin::write_log::format</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">collectd-zfs_arc</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>None</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-01-21 15:05:53 UTC
</div>
</div>
</body>
</html>